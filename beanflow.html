
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <LINK type="text/css" rel="stylesheet" href="resources/space.css">
    <SCRIPT src="resources/space.js" type="text/javascript"></SCRIPT>
    <TITLE>
BeanFlow
    </TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">

    <!-- Banner -->
    <DIV id="site-banner">

      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" class="topbardiv" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/servicemix/images/logo.jpg">
          </TD>
          <TD align="right" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/images/apache-incubator-logo.png">
          </TD>
        </TR> 
      </TABLE>

    </DIV>

    <!-- Bread crumbs and Quick Links -->
    <DIV id="site-navbar">
      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" valign="middle" nowrap="">
            <DIV id="site-breadcrumbs">
<A href="home.html" title="ServiceMix">ServiceMix</A>&nbsp;&gt;&nbsp;<A href="home.html" title="Home">Home</A>&nbsp;&gt;&nbsp;<A href="developers.html" title="Developers">Developers</A>&nbsp;&gt;&nbsp;<A href="ideas.html" title="Ideas">Ideas</A>&nbsp;&gt;&nbsp;<A href="" title="BeanFlow">BeanFlow</A>
            </DIV>
          </TD>
          <TD align="right" valign="middle" nowrap="">
            <DIV id="site-quicklinks">
<P><A href="download.html" title="Download">Download</A> &#124; <SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> <SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" title="Visit page outside Confluence" rel="nofollow">Components<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <A href="source.html" title="Source">Source</A> &#124; <SPAN class="nobr"><A href="home.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124;<SPAN class="nobr"><A href="irc://irc.codehaus.org/servicemix" title="Visit page outside Confluence" rel="nofollow">IRC<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <SPAN class="nobr"><A href="http://servlet.uwyn.com/drone/log/hausbot/servicemix" title="Visit page outside Confluence" rel="nofollow">IRC Log<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A> &#124; <A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A> &#124; <A href="support.html" title="Support">Support</A></P>
            </DIV>
          </TD>
        </TR> 
      </TABLE>
    </DIV>

<!-- Integrate google search later.
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF- 8" />
            <input type="hidden" name="oe" value="UTF- 8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
-->

      <DIV id="site-content">
        <TABLE>
        <TR>
        <TD valign="top">
          <DIV id="site-navigation">
<H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="home.html" title="Home">Home</A></LI>
	<LI><A href="introduction-to-esb.html" title="Introduction to ESB">Introduction to ESB</A></LI>
	<LI><A href="background-to-servicemix.html" title="Background to ServiceMix">Background to ServiceMix</A></LI>
	<LI><A href="news.html" title="News">News</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="site.html" title="Site">Site</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="navigation.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">Contributing</A></LI>
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="users.html" title="Users">Users</A></LI>
</UL>


<H3><A name="Navigation-Documentation"></A>Documentation</H3>

<UL class="alternate" type="square">
	<LI><A href="getting-started.html" title="Getting Started">Getting Started</A></LI>
	<LI><A href="running.html" title="Running">Running</A></LI>
	<LI><A href="examples.html" title="Examples">Examples</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="use-cases-whole.html" title="Use Cases (whole)">Use Cases &#40;whole&#41;</A></LI>
	<LI><A href="configuration.html" title="Configuration">Configuration</A></LI>
	<LI><A href="xml-reference.html" title="Xml Reference">Xml Reference</A></LI>
	<LI><A href="management.html" title="Management">Management</A></LI>
	<LI><A href="architecture.html" title="Architecture">Architecture</A></LI>
	<LI><A href="clustering.html" title="Clustering">Clustering</A></LI>
	<LI><A href="nmr-flows.html" title="NMR Flows">NMR Flows</A></LI>
	<LI><A href="articles.html" title="Articles">Articles</A></LI>
</UL>


<H3><A name="Navigation-Reference"></A>Reference</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://java.sun.com/integration/1.0/docs/sdk/api/index.html" title="Visit page outside Confluence" rel="nofollow">JBI API<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Core<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Components<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-console/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Console<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="glossary.html" title="Glossary">Glossary</A></LI>
</UL>


<H3><A name="Navigation-Features"></A>Features</H3>

<UL class="alternate" type="square">
	<LI><A href="components.html" title="Components">Components</A></LI>
	<LI><A href="routing.html" title="Routing">Routing</A></LI>
	<LI><A href="transformation.html" title="Transformation">Transformation</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="spring-client-toolkit.html" title="Spring Client Toolkit">Spring Client Toolkit</A></LI>
	<LI><A href="client-api.html" title="Client API">Client API</A></LI>
	<LI><A href="" title="BeanFlow">BeanFlow</A></LI>
	<LI><A href="pojo-support.html" title="POJO support">POJO support</A></LI>
	<LI><A href="expressions.html" title="Expressions">Expressions</A></LI>
	<LI><A href="component-helper-classes.html" title="Component helper classes">Component helper classes</A></LI>
	<LI><A href="ant-tasks.html" title="Ant Tasks">Ant Tasks</A></LI>
	<LI><A href="jmx-console.html" title="JMX Console">JMX Console</A></LI>
</UL>


<H3><A name="Navigation-Integration"></A>Integration</H3>

<UL class="alternate" type="square">
	<LI><A href="spring-support.html" title="Spring support">Spring support</A></LI>
	<LI><A href="geronimo-integration.html" title="Geronimo Integration">Geronimo Integration</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Integration</A></LI>
	<LI><A href="tomcat-integration.html" title="Tomcat Integration">Tomcat Integration</A></LI>
	<LI><A href="jonas-integration.html" title="JOnAS Integration">JOnAS Integration</A></LI>
	<LI><A href="jndi-configuration.html" title="JNDI configuration">JNDI configuration</A></LI>
</UL>


<H3><A name="Navigation-ServiceMixComponents"></A>ServiceMix Components</H3>

<UL class="alternate" type="square">
	<LI><A href="bpel.html" title="BPEL">BPEL</A></LI>
	<LI><A href="cache.html" title="Cache">Cache</A></LI>
	<LI><A href="drools.html" title="Drools">Drools</A></LI>
	<LI><A href="email.html" title="Email">Email</A></LI>
	<LI><A href="file.html" title="File">File</A></LI>
	<LI><A href="ftp.html" title="FTP">FTP</A></LI>
	<LI><A href="groovy.html" title="Groovy">Groovy</A></LI>
	<LI><A href="http.html" title="HTTP">HTTP</A></LI>
	<LI><A href="jabber.html" title="Jabber">Jabber</A></LI>
	<LI><A href="jax-ws.html" title="JAX WS">JAX WS</A></LI>
	<LI><A href="jca.html" title="JCA">JCA</A></LI>
	<LI><A href="jms.html" title="JMS">JMS</A></LI>
	<LI><A href="quartz.html" title="Quartz">Quartz</A></LI>
	<LI><A href="reflection.html" title="Reflection">Reflection</A></LI>
	<LI><A href="rss.html" title="RSS">RSS</A></LI>
	<LI><A href="saaj.html" title="SAAJ">SAAJ</A></LI>
	<LI><A href="scripting.html" title="Scripting">Scripting</A></LI>
	<LI><A href="servicemix.html" title="ServiceMix">ServiceMix</A></LI>
	<LI><A href="validation.html" title="Validation">Validation</A></LI>
	<LI><A href="xfire.html" title="XFire">XFire</A></LI>
	<LI><A href="xpath-router.html" title="XPath Router">XPath Router</A></LI>
	<LI><A href="xslt.html" title="XSLT">XSLT</A></LI>
	<LI><A href="xsql.html" title="XSQL">XSQL</A></LI>
	<LI><A href="vfs.html" title="VFS">VFS</A></LI>
	<LI><A href="wsif.html" title="WSIF">WSIF</A></LI>
</UL>


<H3><A name="Navigation-Tooling"></A>Tooling</H3>

<UL class="alternate" type="square">
	<LI><A href="visualisation.html" title="Visualisation">Visualisation</A></LI>
	<LI><A href="eclipse-plugin.html" title="Eclipse plugin">Eclipse plugin</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Deployer</A></LI>
	<LI><A href="war-deployment.html" title="WAR Deployment">WAR Deployment</A></LI>
	<LI><A href="maven-jbi-plugin.html" title="Maven JBI plugin">Maven JBI plugin</A></LI>
	<LI><A href="maven-sar-plugin.html" title="Maven SAR plugin">Maven SAR plugin</A></LI>
</UL>


<H3><A name="Navigation-OtherJBIsoftware"></A>Other JBI software</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/projects/ode.html" title="Orchestration Engine" rel="nofollow">Apache ODE<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://activemq.codehaus.org/" title="High Performance Message Bus" rel="nofollow">Apache ActiveMQ<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://lingo.codehaus.org/" title="POJO Remoting using JMS" rel="nofollow">Lingo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://jencks.org/" title="Message Driven POJOs and pooling for JMS and JDBC" rel="nofollow">Jencks<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://stomp.codehaus.org/" title="Simple cross language protocol for messaging" rel="nofollow">Stomp<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.springframework.org/" title="Visit page outside Confluence" rel="nofollow">Spring<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://geronimo.apache.org/" title="Visit page outside Confluence" rel="nofollow">Geronimo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://forge.objectweb.org/projects/celtix/" title="Visit page outside Confluence" rel="nofollow">Celtix<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://xfire.codehaus.org/" title="Visit page outside Confluence" rel="nofollow">XFire<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Support"></A>Support</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM" title="Visit page outside Confluence" rel="nofollow">Issues<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:roadmap-panel" title="Visit page outside Confluence" rel="nofollow">Roadmap<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:changelog-panel" title="Visit page outside Confluence" rel="nofollow">Change log<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Developers"></A>Developers</H3>

<UL class="alternate" type="square">
	<LI><A href="source.html" title="Source">Source</A></LI>
	<LI><A href="roadmap.html" title="Roadmap">Roadmap</A></LI>
	<LI><A href="ideas.html" title="Ideas">Ideas</A></LI>
	<LI><A href="becoming-a-committer.html" title="Becoming a committer">Becoming a committer</A></LI>
	<LI><A href="release-guide.html" title="Release Guide">Release Guide</A></LI>
	<LI><SPAN class="nobr"><A href="http://ci.codehaus.org/beetlejuice/viewProjectSummary.action?projectName=ServiceMix" title="Visit page outside Confluence" rel="nofollow">BeetleJuice<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/clover/" title="Visit page outside Confluence" rel="nofollow">Clover Report<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/xref/index.html" title="Visit page outside Confluence" rel="nofollow">Source XRef<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/xref-test/index.html" title="Visit page outside Confluence" rel="nofollow">Test Source XRef<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix.xsd.html" title="Visit page outside Confluence" rel="nofollow">XSD<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Toolsweuse"></A>Tools we use</H3>

<P><SPAN class="nobr"><A href="http://www.yourkit.com/" title="Visit page outside Confluence" rel="nofollow"><IMG src="navigation.data/yourkit.jpg" align="absmiddle" border="0"><SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>
          </DIV>
        </TD>
        <TD valign="top">
          <DIV id="site-page">

<!--          
            <div class="pagetitle">BeanFlow</div>
-->
            <DIV class="wiki-content"><P>BeanFlow is a lightweight Java library for building workflows using beans to orchestrate events. You can think of BeanFlow as a simple alternative to <A href="bpel.html" title="BPEL">BPEL</A> where the workflows are all specified and implemented using Java code rather than declarative XML.</P>

<H3><A name="BeanFlow-QuickLinks"></A>Quick Links</H3>

<UL>
	<LI><A href="beanflow-patterns.html" title="BeanFlow Patterns">BeanFlow Patterns</A></LI>
</UL>


<H3><A name="BeanFlow-Motivation"></A>Motivation</H3>

<P>When building highly concurrent or distributed applications it is very common for there to be many events happening; often asynchronously and in different threads and its very common to need to perform kinds of workflow or orchestration across these events.</P>

<P>Now you certainly can use things like <A href="bpel.html" title="BPEL">BPEL</A> to solve these kinds of problems. However often this is a bit heavy weight &amp; complex and you just want to have a bean based workflow using regular Java code to represent the activities involved in the workflow.</P>

<H3><A name="BeanFlow-Transformingthetraditionalworkflowapproach"></A>Transforming the traditional workflow approach</H3>

<P>One of the main goals of BeanFlow is to reuse what the Java platform is good for in the workflow space; then supplement it with missing abstractions rather than inventing the wheel in a sub-optimal way.</P>

<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Traditional approach</TH>
<TH class="confluenceTh">BeanFlow approach</TH>
</TR>
<TR>
<TD class="confluenceTd"> use a declarative workflow language to specify a workflow </TD>
<TD class="confluenceTd"> write a Java class </TD>
</TR>
<TR>
<TD class="confluenceTd"> use XML markup or pictures to define loops and flows </TD>
<TD class="confluenceTd"> use regular Java code (if/for/while) </TD>
</TR>
<TR>
<TD class="confluenceTd"> implement a generic state and persistence framework for workflow instances </TD>
<TD class="confluenceTd"> use regular Java fields in your workflow class, then use JDBC/DAO/JPA to deal with persistence </TD>
</TR>
</TBODY></TABLE>

<H3><A name="BeanFlow-Usecases"></A>Use cases</H3>

<P>When working with concurrent or distributed applications there are many use cases for needing to orchestrate among multiple concurrent events. Here are a few examples from our use cases implementing <A href="home.html" title="Home">ServiceMix</A> and <SPAN class="nobr"><A href="http://activemq.org/" title="Visit page outside Confluence" rel="nofollow">ActiveMQ<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>

<UL>
	<LI>starting dependent services; where a parent component is dependent on the child components starting; where the start process may be asynchronous in different threads. e.g. there may be a recovery process on startup which you need to wait for.</LI>
	<LI>implementing master-slave type protocols where you need to monitor the state of the master and slave to make decisions on what to do; together with dealing with transitions from <EM>Started</EM> to <EM>Recovering</EM> to <EM>Running</EM> then maybe to <EM>FailingOver</EM> etc.</LI>
	<LI>implementing message orchestration. You may want to implement some simple orchestrations, waiting for either a response to arrive or a timeout to fire etc</LI>
</UL>


<H2><A name="BeanFlow-Activityoverview"></A>Activity overview</H2>

<P>An activity is just a POJO which implements the Activity interface; it has a simple lifecycle, you can start them and stop them and ask their status.</P>

<P>Once a flow has been started via the <B>start()</B> method it can take an arbitrarily long time to complete; you can see if the flow has completed via the <B>isStopped()</B> method. You can explicitly complete a flow using the <B>stop()</B> method whenever you like; typically when you are responding to state changes.</P>

<P>An activity could fail for some reason (such as it timed out or some error occurred) so there is a method <B>isFailed()</B> which can be used to easily inspect the activity. Rather like the <B>stop()</B> method, you can call <B>fail(reason)</B> if you wish to terminate an activity with the activity marked as the Failed rather than Stopped state.</P>

<H3><A name="BeanFlow-Usingtimeouts"></A>Using timeouts</H3>

<P>Its very common to add timeouts onto activities so that if the activity is not complete by a certain time then the activity is stopped &amp; failed; often another parent activity may then do something differently if one of its child activities fails.</P>

<P>There is a useful base activity called <B>TimeoutActivity</B> which you can derive from to make your own activity which can be started/stopped/failed and which can be timed out.</P>

<P>You can explicitly register the activity with a timer and call the <B>onTimedOut()</B> method yourself or just call the <B>startWithTimeout()</B> method to start the activity registering the timeout.</P>

<H3><A name="BeanFlow-Composingactivities"></A>Composing activities</H3>

<P>One of the main reasons for using an object orientated language is to make composition and reuse possible; similarly BeanFlow allows you to compose activities together to make modular and reusable workflow constructs easily. So BeanFlow attempts to create a collection of reusable activities which you can then use to derive from or aggregate to make whatever activities you need.</P>

<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Composition Activities</TH>
<TH class="confluenceTh">Description</TH>
</TR>
<TR>
<TD class="confluenceTd">JoinAll</TD>
<TD class="confluenceTd">Performs a join on all the given child activities. So the activity waits until all the child activities have completed, then it completes itself. You can add additional constraints to the activity using derivation. The default is to wait for all the child activities to complete; though you can enable fast-fail mode so that the activity fails as soon as a child activity fails</TD>
</TR>
<TR>
<TD class="confluenceTd">JoinQuorum</TD>
<TD class="confluenceTd">This activity is useful for implementing clustering style activities where you want a quorum of activities to complete. e.g. if you have 5 child activities you want to wait for at least 3 activities to complete succesfully before continuing</TD>
</TR>
<TR>
<TD class="confluenceTd">AsynchronousActivity</TD>
<TD class="confluenceTd">Executes any Runnable or Callable on an Executor and complete the activity when it has completed so that it can be used in joins</TD>
</TR>
<TR>
<TD class="confluenceTd">ParallelActivity</TD>
<TD class="confluenceTd">Allows a collection of parallel Runnable or Callable objects to be performed on an Executor then performing some kind of join on them completing</TD>
</TR>
</TBODY></TABLE>

<P>Here is an example of performing joins using collections of child workflows</P>

<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-comment">// lets create a join on a number of child flows completing
</SPAN>JoinAll flow = <SPAN class="code-keyword">new</SPAN> JoinAll(child1, child2, child3);
flow.startWithTimeout(timer, timeout);

<SPAN class="code-comment">// now lets test the flow
</SPAN>child1.stop();
assertFlowStarted(flow);

child2.stop();
assertFlowStarted(flow);

child3.stop();
assertFlowStopped(flow);</PRE>
</DIV></DIV>

<H3><A name="BeanFlow-Joinconditions"></A>Join conditions</H3>

<P>In workflows you often want to fork parallel steps and then join on certain events. You often have complex logic to decide on what the join condition is. e.g. in pseudo code</P>

<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">fork steps A, B, C
join on A and (B or C)</PRE>
</DIV></DIV>

<P>In BeanFlow we implement join conditions using regular Java code. The basic idea is that a Activity will listen to changes in a number of different <B>State</B> objects such as fields a, b and c. You can then write an activity bean to perform the join condition you need. When the condition is met you can then perform whatever logic you wish such as</P>

<UL>
	<LI>stopping the activity</LI>
	<LI>forking off a new child activity</LI>
	<LI>changing your state</LI>
	<LI>changing the state of some other bean</LI>
	<LI>calling arbitrary Java code</LI>
</UL>


<P>Here is an example activity implemented in Java code for the above code.</P>

<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-comment">// lets create some child workflows
</SPAN><SPAN class="code-keyword">final</SPAN> Activity a = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();
<SPAN class="code-keyword">final</SPAN> Activity b = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();
<SPAN class="code-keyword">final</SPAN> Activity c = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();

<SPAN class="code-comment">// lets create the activity with a custom join condition
</SPAN>Activity activity = <SPAN class="code-keyword">new</SPAN> JoinSupport(a, b, c) {
    @Override
    <SPAN class="code-keyword">protected</SPAN> void onChildStateChange(<SPAN class="code-object">int</SPAN> childCount, <SPAN class="code-object">int</SPAN> stoppedCount, <SPAN class="code-object">int</SPAN> failedCount) {
        
        <SPAN class="code-keyword">if</SPAN> (a.isStopped() &amp;&amp; (b.isStopped() || c.isStopped())) {
            <SPAN class="code-comment">// lets stop the activity we&apos;re done
</SPAN>            stop();
        }
    }
};

<SPAN class="code-comment">// lets start the activities
</SPAN>activity.startWithTimeout(timer, timeout);

<SPAN class="code-comment">// now lets test things behave properly
</SPAN>assertFlowStarted(activity);

a.stop();
assertFlowStarted(activity);

b.stop();
assertFlowStopped(activity);</PRE>
</DIV></DIV>

<H2><A name="BeanFlow-Buildingworkflows"></A>Building workflows</H2>

<P>So we&apos;ve been over the basics of activities and showed how we can perform joins along with compose them. Remember they are just Java bean so you can implement them however you wish.</P>

<P>However often folks think of workflows as a number of discrete steps; using a kind of state machine to move from step to step. One real simple approach to<BR>
writing workflows in this model is to use a specific method for each workflow step.</P>

<P>So we have a base class called Workflow which adds a new State object for the current step (which allows actvities to listen to the step changing) together with helper methods for moving to different steps, for suspending and so forth.</P>

<H3><A name="BeanFlow-Movingsteps"></A>Moving steps</H3>

<P>Inside a step you can call any Java methods on any objects. However to move from step to step in a declarative fashion you can call the <B>goTo()</B> method.<BR>
Another option is to use a method which returns a String; a non-null String is then interpreted as being the next step that is navigated to next.</P>

<P>Note that the movement to the next step always takes place outside of the step method to avoid deeply recursive methods.</P>

<H3><A name="BeanFlow-Suspendingworkflows"></A>Suspending workflows</H3>

<P>Often in a workflow you have to wait for some external event such as</P>
<UL>
	<LI>a user enters some text</LI>
	<LI>a message is received</LI>
</UL>


<P>Once that happens you re-awaken the workflow and commence execution at some step. To implement this just call the goTo() method to cause the workflow to resume at the given step</P>

<H3><A name="BeanFlow-Example"></A>Example</H3>

<P>The following example is a fairly large one, but it shows a variety of different concepts</P>

<UL>
	<LI>suspending workflows (such as when they wait for external events such as user input or an asynchronous message to arrive)</LI>
	<LI>looping &amp; using predicates</LI>
	<LI>forking and joining child activities</LI>
	<LI>declaratively moving from one step to another</LI>
</UL>


<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class ExampleWorkflow <SPAN class="code-keyword">extends</SPAN> Workflow {

    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">int</SPAN> loopCount;
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">long</SPAN> timeout = 500;
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> userEmailAddress;

    <SPAN class="code-comment">// Workflow steps
</SPAN>    <SPAN class="code-comment">// -------------------------------------------------------------------------
</SPAN>
    <SPAN class="code-comment">// This is the first step of a workflow by <SPAN class="code-keyword">default</SPAN>
</SPAN>    <SPAN class="code-comment">// but you can start at any point by passing in a parameter
</SPAN>    <SPAN class="code-comment">// to the Workflow constructor 
</SPAN>    <SPAN class="code-keyword">public</SPAN> void startStep() {
        <SPAN class="code-comment">// lets use an explicit goTo() to tell the workflow 
</SPAN>        <SPAN class="code-comment">// which step to go to next; though we can just <SPAN class="code-keyword">return</SPAN> Strings
</SPAN>        goTo(<SPAN class="code-quote">&quot;loopStep&quot;</SPAN>);
    }

    <SPAN class="code-comment">// lets use the <SPAN class="code-keyword">return</SPAN> value to specify the next step
</SPAN>    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> loopStep() {
        <SPAN class="code-keyword">if</SPAN> (++loopCount &gt; 3) {
            <SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;waitForUserInputStep&quot;</SPAN>;
        }
        <SPAN class="code-comment">// lets keep looping
</SPAN>        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;loopStep&quot;</SPAN>;
    }
    
    <SPAN class="code-keyword">public</SPAN> void waitForUserInputStep() {
        <SPAN class="code-comment">// we are going to park here until a user 
</SPAN>        <SPAN class="code-comment">// enters a valid email address
</SPAN>        <SPAN class="code-comment">// so lets park the workflow engine
</SPAN>    }
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> afterEnteredEmailStep() {
        <SPAN class="code-comment">// we are going to park here until a user 
</SPAN>        <SPAN class="code-comment">// enters a valid email address
</SPAN>        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;User entered email address: &quot;</SPAN> + userEmailAddress);
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;forkStep&quot;</SPAN>;
    }
    
    <SPAN class="code-keyword">public</SPAN> void forkStep() {
        <SPAN class="code-comment">// lets fork some child flows
</SPAN>        TimeoutActivity a = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();
        TimeoutActivity b = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();
        TimeoutActivity c = <SPAN class="code-keyword">new</SPAN> TimeoutActivity();
        
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Forking off processes a, b, c&quot;</SPAN>);
        fork(a, b, c);
        
        <SPAN class="code-comment">// now lets add some joins
</SPAN>        joinAll(<SPAN class="code-quote">&quot;aCompletedStep&quot;</SPAN>,timeout, a);
        joinAll(<SPAN class="code-quote">&quot;abcCompletedStep&quot;</SPAN>, timeout, a, b, c);
    }
    
    <SPAN class="code-keyword">public</SPAN> void aCompletedStep() {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;child flow A completed!&quot;</SPAN>);
    }
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> abcCompletedStep() {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;child flows A, B and C completed!&quot;</SPAN>);
        
        <SPAN class="code-comment">// we are completely done now
</SPAN>        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;stop&quot;</SPAN>;
    }

    <SPAN class="code-comment">// External events
</SPAN>    <SPAN class="code-comment">// -------------------------------------------------------------------------
</SPAN>    <SPAN class="code-keyword">public</SPAN> void userEntered(<SPAN class="code-object">String</SPAN> emailAddress) {
        <SPAN class="code-keyword">if</SPAN> (emailAddress != <SPAN class="code-keyword">null</SPAN> &amp;&amp; emailAddress.indexOf(<SPAN class="code-quote">&quot;@&quot;</SPAN>) &gt; 0) {
            <SPAN class="code-keyword">this</SPAN>.userEmailAddress = emailAddress;
            
            <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Lets re-start the suspended workflow&quot;</SPAN>);
            goTo(<SPAN class="code-quote">&quot;afterEnteredEmailStep&quot;</SPAN>);
        }
    }
}</PRE>
</DIV></DIV>

<P>In the above example, each workflow step is implemented as a method. If the method returns a String it is interpreted as the next step which will be executed. Returning null (or using a void return type) will suspend the workflow.</P>

<P>You can also explicitly call suspend() or stop() yourself.</P>

<P>The goTo(stepName) will instruct the workflow engine to move to the given step.</P></DIV>
          
                  <DIV class="tabletitle">
            Children
            <SPAN class="smalltext" id="show" style="display: inline;">
              <A href="javascript:showChildren()">Show Children</A></SPAN>
            <SPAN class="smalltext" id="hide" style="display: none;">
              <A href="javascript:hideChildren()">Hide Children</A></SPAN>
          </DIV>
          <DIV class="greybox" id="children" style="display: none;">
                                      <A href="beanflow-patterns.html" title="BeanFlow Patterns">BeanFlow Patterns</A>
              <SPAN class="smalltext">(ServiceMix)</SPAN>
              <BR>
                      </DIV>
                  </DIV>
        </TD>
      </TR>
      </TABLE>     
      </DIV>
    </DIV>
    <DIV id="site-footer">
          Added by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=jstrachan">James Strachan</A>,
    last edited by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=jstrachan">James Strachan</A> on May 15, 2006
                  &nbsp;(<A href="http://goopen.org/confluence/pages/diffpages.action?pageId=5092&originalId=5795">view change</A>)
              
      (<A href="http://goopen.org/confluence/pages/editpage.action?pageId=5092">edit page</A>)
    </DIV>

  </BODY>

</HTML>