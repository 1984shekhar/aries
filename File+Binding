<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html>  <head>    <link rel="stylesheet" href="http://codehaus.org/codehaus-style.css" type="text/css">        <link rel="stylesheet" href="style.css" type="text/css">    <title>ServiceMix - File Binding</title>  </head>  <body>    <table width="100%" id="layout" style="padding:0px;margin0px;border-collapse:collapse;">      <tr>        <td colspan="3" style="padding:8px;">          <table width="100%" id="banner" style="padding:0px;margin:0px">            <tr id="header_row">              <td align="left" valign="middle" style="padding:0px;margin:0px;">                <span id="Content"><span><span class="nobr"><a href="http://incubator.apache.org/servicemix" rel="nofollow"><img align="absmiddle" border=0 src="images/logo.gif"></a></span></span></span>              </td>              <td align="right" valign="middle" style="padding:0px;margin:0px;">                <span id="Content"><span><span class="nobr"><a href="http://incubator.apache.org" rel="nofollow"><img align="absmiddle" border=0 src="http://incubator.apache.org/images/apache-incubator-logo.png"></a></span></span></span>              </td>            </tr>          </table>        </td>      </tr>      <tr>        <td colspan="3" id="breadcrumbs">          <table width="100%" id="banner" style="padding:0px;margin:0px">            <tr>              <td align="left">                <a href="">Home</a>  | <a href="Navigation">Navigation</a> &gt; <a href="Examples">Examples</a> &gt; file binding              </td>              <td align="right">                  <span id="Content"><span><a href="Download" title="Download">Download</a> | <span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" rel="nofollow">JavaDocs</a></span> <span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" rel="nofollow">Components</a></span> | <a href="Source" title="Source">Source</a> | <span class="nobr"><a href="http://docs.codehaus.org/pages/listpages.action?key=SM" rel="nofollow">Wiki</a></span> |<span class="nobr"><a href="irc://irc.codehaus.org/servicemix" rel="nofollow">IRC</a></span> | <span class="nobr"><a href="http://servlet.uwyn.com/drone/log/hausbot/servicemix" rel="nofollow">IRC Log</a></span> | <a href="Mailing+Lists" title="Mailing Lists">Mailing Lists</a> | <span class="nobr"><a href="http://forums.logicblaze.com/forums/show/3.page" rel="nofollow">Discussion Forum</a></span>| <span class="nobr"><a href="http://jira.logicblaze.com/jira/browse/SM" rel="nofollow">Support</a></span></span></span>              </td>            </tr>          </table>        </td>      </tr>      <tr>        <td id="leftColumn" valign="top" style="padding-top: 0px;">          <span id="Content"><h3><a name="Navigation-Overview"></a>Overview</h3>  <ul class="alternate" type="square">    <li><a href="Home" title="Home">Home</a></li>    <li><a href="Introduction+to+ESB" title="Introduction to ESB">Introduction to ESB</a></li>    <li><a href="Background+to+ServiceMix" title="Background to ServiceMix">Background to ServiceMix</a></li>    <li><a href="News" title="News">News</a></li>    <li><a href="FAQ" title="FAQ">FAQ</a></li>    <li><a href="Download" title="Download">Download</a></li>  </ul>  <h3><a name="Navigation-Community"></a>Community</h3>  <ul class="alternate" type="square">    <li><span class="nobr"><a href="http://docs.codehaus.org/pages/listpages.action?key=SM" rel="nofollow">Wiki</a></span></li>    <li><a href="Mailing+Lists" title="Mailing Lists">Mailing Lists</a></li>    <li><a href="Contributing" title="Contributing">Contributing</a></li>    <li><a href="Team" title="Team">Team</a></li>    <li><a href="Users" title="Users">Users</a></li>  </ul>  <h3><a name="Navigation-Documentation"></a>Documentation</h3>  <ul class="alternate" type="square">    <li><a href="Getting+Started" title="Getting Started">Getting Started</a></li>    <li><a href="Running" title="Running">Running</a></li>    <li><a href="Examples" title="Examples">Examples</a></li>    <li><a href="Use+Cases" title="Use Cases">Use Cases</a></li>    <li><a href="Configuration" title="Configuration">Configuration</a></li>    <li><a href="Xml+Reference" title="Xml Reference">Xml Reference</a></li>    <li><a href="Management" title="Management">Management</a></li>    <li><a href="Architecture" title="Architecture">Architecture</a></li>    <li><a href="Clustering" title="Clustering">Clustering</a></li>    <li><a href="NMR+Flows" title="NMR Flows">NMR Flows</a></li>    <li><a href="Articles" title="Articles">Articles</a></li>  </ul>  <h3><a name="Navigation-Reference"></a>Reference</h3>  <ul class="alternate" type="square">    <li><span class="nobr"><a href="http://java.sun.com/integration/1.0/docs/sdk/api/index.html" rel="nofollow">JBI API</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" rel="nofollow">JavaDocs Core</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" rel="nofollow">JavaDocs Components</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-console/apidocs/" rel="nofollow">JavaDocs Console</a></span></li>    <li><a href="Glossary" title="Glossary">Glossary</a></li>  </ul>  <h3><a name="Navigation-Features"></a>Features</h3>  <ul class="alternate" type="square">    <li><a href="Components" title="Components">Components</a></li>    <li><a href="Routing" title="Routing">Routing</a></li>    <li><a href="Transformation" title="Transformation">Transformation</a></li>    <li><a href="Spring+Client+Toolkit" title="Spring Client Toolkit">Spring Client Toolkit</a></li>    <li><a href="Client+API" title="Client API">Client API</a></li>    <li><a href="POJO+support" title="POJO support">POJO support</a></li>    <li><a href="Expressions" title="Expressions">Expressions</a></li>    <li><a href="Component+helper+classes" title="Component helper classes">Component helper classes</a></li>    <li><a href="Ant+Tasks" title="Ant Tasks">Ant Tasks</a></li>    <li><a href="JMX+Console" title="JMX Console">JMX Console</a></li>  </ul>  <h3><a name="Navigation-Integration"></a>Integration</h3>  <ul class="alternate" type="square">    <li><a href="Spring+support" title="Spring support">Spring support</a></li>    <li><a href="Geronimo+Integration" title="Geronimo Integration">Geronimo Integration</a></li>    <li><a href="JBoss+Deployer" title="JBoss Deployer">JBoss Integration</a></li>    <li><a href="Tomcat+Integration" title="Tomcat Integration">Tomcat Integration</a></li>    <li><a href="JNDI+configuration" title="JNDI configuration">JNDI configuration</a></li>  </ul>  <h3><a name="Navigation-ServiceMixComponents"></a>ServiceMix Components</h3>  <ul class="alternate" type="square">    <li><a href="BPEL" title="BPEL">BPEL</a></li>    <li><a href="Cache" title="Cache">Cache</a></li>    <li><a href="Drools" title="Drools">Drools</a></li>    <li><a href="Email" title="Email">Email</a></li>    <li><a href="File" title="File">File</a></li>    <li><a href="FTP" title="FTP">FTP</a></li>    <li><a href="Groovy" title="Groovy">Groovy</a></li>    <li><a href="HTTP" title="HTTP">HTTP</a></li>    <li><a href="Jabber" title="Jabber">Jabber</a></li>    <li><a href="JAX+WS" title="JAX WS">JAX WS</a></li>    <li><a href="JCA" title="JCA">JCA</a></li>    <li><a href="JMS" title="JMS">JMS</a></li>    <li><a href="Quartz" title="Quartz">Quartz</a></li>    <li><a href="Reflection" title="Reflection">Reflection</a></li>    <li><a href="RSS" title="RSS">RSS</a></li>    <li><a href="SAAJ" title="SAAJ">SAAJ</a></li>    <li><a href="Scripting" title="Scripting">Scripting</a></li>    <li><a href="ServiceMix" title="ServiceMix">ServiceMix</a></li>    <li><a href="Validation" title="Validation">Validation</a></li>    <li><a href="XFire" title="XFire">XFire</a></li>    <li><a href="XPath+Router" title="XPath Router">XPath Router</a></li>    <li><a href="XSLT" title="XSLT">XSLT</a></li>    <li><a href="XSQL" title="XSQL">XSQL</a></li>    <li><a href="VFS" title="VFS">VFS</a></li>    <li><a href="WSIF" title="WSIF">WSIF</a></li>  </ul>  <h3><a name="Navigation-Tooling"></a>Tooling</h3>  <ul class="alternate" type="square">    <li><a href="Eclipse+plugin" title="Eclipse plugin">Eclipse plugin</a></li>    <li><a href="JBoss+Deployer" title="JBoss Deployer">JBoss Deployer</a></li>    <li><a href="WAR+Deployment" title="WAR Deployment">WAR Deployment</a></li>    <li><a href="Maven+JBI+plugin" title="Maven JBI plugin">Maven JBI plugin</a></li>    <li><a href="Maven+SAR+plugin" title="Maven SAR plugin">Maven SAR plugin</a></li>  </ul>  <h3><a name="Navigation-Utilities"></a>Utilities</h3>  <ul class="alternate" type="square">    <li><a href="Reflection" title="Reflection">Reflection</a></li>  </ul>  <h3><a name="Navigation-OtherJBIsoftware"></a>Other JBI software</h3>  <ul class="alternate" type="square">    <li><span class="nobr"><a href="http://forge.objectweb.org/projects/celtix/" rel="nofollow">Celtix</a></span></li>    <li><span class="nobr"><a href="http://pxe.fivesight.com/wiki/display/PXE/Home" rel="nofollow" title="Visit page outside Confluence">PXE BPEL Engine</a></span></li>  </ul>  <h3><a name="Navigation-RelatedProjects"></a>Related Projects</h3>  <ul class="alternate" type="square">    <li><span class="nobr"><a href="http://activemq.codehaus.org/" rel="nofollow">ActiveMQ</a></span></li>    <li><span class="nobr"><a href="http://jencks.org/" rel="nofollow">Jencks</a></span></li>    <li><span class="nobr"><a href="http://lingo.codehaus.org/" rel="nofollow">Lingo</a></span></li>    <li><span class="nobr"><a href="http://activesoap.codehaus.org/" rel="nofollow">ActiveSOAP</a></span></li>    <li><span class="nobr"><a href="http://www.springframework.org/" rel="nofollow">Spring</a></span></li>    <li><span class="nobr"><a href="http://geronimo.apache.org/" rel="nofollow">Geronimo</a></span></li>  </ul>  <h3><a name="Navigation-Support"></a>Support</h3>  <ul class="alternate" type="square">    <li><span class="nobr"><a href="http://jira.logicblaze.com/jira/browse/SM" rel="nofollow">Issues</a></span></li>    <li><span class="nobr"><a href="http://jira.logicblaze.com/browse/SM?report=com.atlassian.jira.plugin.system.project:roadmap-panel" rel="nofollow">Roadmap</a></span></li>    <li><span class="nobr"><a href="http://jira.logicblaze.com/browse/SM?report=com.atlassian.jira.plugin.system.project:changelog-panel" rel="nofollow">Change log</a></span></li>  </ul>  <h3><a name="Navigation-Developers"></a>Developers</h3>  <ul class="alternate" type="square">    <li><a href="Source" title="Source">Source</a></li>    <li><a href="Roadmap" title="Roadmap">Roadmap</a></li>    <li><a href="Ideas" title="Ideas">Ideas</a></li>    <li><a href="Becoming+a+committer" title="Becoming a committer">Becoming a committer</a></li>    <li><a href="Release+Guide" title="Release Guide">Release Guide</a></li>    <li><span class="nobr"><a href="http://ci.codehaus.org/beetlejuice/viewProjectSummary.action?projectName=ServiceMix" rel="nofollow">BeetleJuice</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/clover/" rel="nofollow">Clover Report</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/xref/index.html" rel="nofollow">Source XRef</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/xref-test/index.html" rel="nofollow">Test Source XRef</a></span></li>    <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix.xsd.html" rel="nofollow">XSD</a></span></li>  </ul>  <h3><a name="Navigation-Toolsweuse"></a>Tools we use</h3><span><span class="nobr"><a href="http://www.yourkit.com" rel="nofollow"><img align="absmiddle" border=0 src="http://www.servicemix.org/download/attachments/25208/yourkit.jpg"></a></span></span></span>            <h3 class="heading3">Feeds</h3>            <table border="0" cellspacing="4px">            <tr>              <td align="right">                <a href="http://docs.codehaus.org/spaces/rss.action?key=SM&newPages=false"><img src="http://docs.codehaus.org/images/icons/rss.gif" border="0"></a><br/>              </td>              <td align="left">                <a href="http://docs.codehaus.org/spaces/rss.action?key=SM&newPages=false">Site</a>              </td>            </tr>            <tr>              <td align="right">                <a href="http://docs.codehaus.org/spaces/blogrss.action?key=SM"><img src="http://docs.codehaus.org/images/icons/rss.gif" border="0"></a>              </td>              <td align="left">                <a href="http://docs.codehaus.org/spaces/blogrss.action?key=SM">News</a>              </td>            </tr>            </table>        </td>        <td id="rightColumn" valign="top">          <div id="page_title">            <table width="100%">              <tr>                <td>            File Binding                 </td>                <td align="right">                            </td>              </tr>            </table>          </div>          <div>  <div id="Content">    <h3><a name="filebinding-OverviewoftheServiceMixFileBindingExample"></a>Overview of the ServiceMix File Binding Example</h3>    <p>This document describes how to run ServiceMix's <em>File Binding</em> example and provides details about what it does. For information on the business use case, please refer to: <span class="nobr"><a href="http://www.servicemix.org/Use+Cases" rel="nofollow">Use Case for File Binding</a></span>.</p>    <p>The <em>File Binding</em> example illustrates the following:</p>    <ul>      <li>an example of declarative programming</li>      <li>how to interact with the file system</li>      <li>how to use a WorkManager thread pool</li>    </ul>    <p>The XML code for the <em>File Binding</em> example is located in the ServiceMix installation directory under the <tt>examples\file-binding</tt> directory in the <tt>servicemix.xml</tt> file. It is recommended that you refer to the <tt>servicemix.xml</tt> file while reading this document.</p>    <p>The <em>File Binding</em> XML file, <tt>servicemix.xml</tt>, contains two components and a supporting bean. One component waits for a file to be deposited into the the <tt>inbox</tt>directory, retrieves it, creates a normalized message that contains the file, then sends the message to the Normalized Message Router (NMR). The NMR routes the file to the other component, which deposits it into an <tt>outbox</tt> directory. The bean provides a thread pool to enhance the performance of the reading and processing of the files. Details about the components and bean are discussed below.</p>    <p class="paragraph">      <table align="center" border=0 cellpadding=5 cellspacing="8px" class="infoMacro" width="85%">        <colgroup>          <col width=24>          <col>        </colgroup>        <tr>          <td valign="top"><img align="absmiddle" alt="" border=0 height=16 src="http://www.servicemix.org/images/icons/emoticons/information.gif" width=16></td>          <td><b class="strong">Note</b><br>            <br> The file to be transmitted from the inbox to outbox must be in XML format.</td>        </tr>      </table>    </p>    <h3><a name="filebinding-RunningtheFileBindingExample"></a>Running the <em>File Binding</em> Example</h3>    <p>From a command shell, go to the <em>File Binding</em> example directory:</p>    <p class="paragraph">      <div class="code">        <div class="codeContent"><pre class="code-java">cd [servicemix_install_dir]\examples\file-binding</pre></div>      </div>    </p>    <p>where <tt>servicemix_install_dir</tt> is the directory in which ServiceMix was installed.</p>    <p>Before running the example, copy a test file into the inbox directory:</p>    <p class="paragraph">      <div class="code">        <div class="codeContent"><pre class="code-java">copy test-file.xml inbox</pre></div>      </div>    </p>    <p>Then type:</p>    <p class="paragraph">      <div class="code">        <div class="codeContent"><pre class="code-java">[servicemix_install_dir]\bin\servicemix servicemix.xmlOR..\..\bin\servicemix servicemix.xml</pre></div>      </div>    </p>    <p>      <br clear="all"> After a few seconds, the <tt>sample_xxx.xml</tt>file will appear in the outbox directory. To see this open another command window and do a directory listing on the outbox directory, for example:</p>    <p class="paragraph">      <div class="code">        <div class="codeContent"><pre class="code-java">dir [servicemix_install_dir]\examples\file-binding\outbox</pre></div>      </div>    </p>    <p>If you would like to see more files moved from <tt>inbox</tt> to <tt>outbox</tt>, copy another file into the <tt>inbox</tt> directory. The <em>file binding</em> program continually polls (every 1000 ms) for new files, so any new file placed in <tt>inbox</tt>, will be transmitted to <tt>outbox</tt>. <br clear="all">    </p>    <p class="paragraph">      <table align="center" border=0 cellpadding=5 cellspacing="8px" class="tipMacro" width="85%">        <colgroup>          <col width=24>          <col>        </colgroup>        <tr>          <td valign="top"><img align="absmiddle" alt="" border=0 height=16 src="http://www.servicemix.org/images/icons/emoticons/check.gif" width=16></td>          <td><b class="strong">Handy Hint</b><br>            <br> Add <em>$SERVICEMIX_HOME/bin</em> directory to <em>$PATH</em> variable to simplify execution of the example.</td>        </tr>      </table>    </p>    <h3><a name="filebinding-StoppingtheFileBindingExample"></a>Stopping the <em>File Binding</em> Example</h3>    <p>To terminate the <em>File Binding</em> example type &quot;CTRL-C&quot; in the command shell in which it is running and answer &quot;y&quot; to the &quot;Terminate batch job (y/n)?&quot; question. <br clear="all">    </p>    <h3><a name="filebinding-HowitWorks"></a>How it Works</h3>    <p>The diagram below illustrates the logical flow of the program through the <em>file binding</em> components.</p>    <p>      <br clear="all">      <br clear="all">    </p>    <p class="paragraph">      <div class="panel" style="border-style: solid; border-color: #ccc; ">        <div class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><b>File Binding Logical Flow Diagram</b></div>        <div class="panelContent">          <div align="center"><img border=0 src="http://www.servicemix.org/download/attachments/29644/filebindingexample.jpg"></div>        </div>      </div>    </p>    <p>      <br clear="all">      <br clear="all">    </p>    <p>The logical flow of the program is:</p>    <p class="paragraph">      <ol>        <li>The <em>filePoller</em> polls the <tt>inbox</tt> directory every 1000 ms looking for a file.</li>        <li>Once a file appears in the <tt>inbox</tt> directory, the <em>filePoller</em> gets a thread from the <em>workManager</em>. The thread will be used to process the file.</li>        <li>The <em>filePoller</em>creates a normalized message that contains the file to be transmitted. It sends the normalized message to the NMR. The NMR routes the message to the <em>fileSender</em> component.</li>        <li>The <em>fileSender</em> transforms the normalized message back into a file and &quot;sends&quot; it (places it) to the <tt>outbox</tt> directory.</li>      </ol>    </p>    <p>Logging information is written to the console as files are transmitted. Typical output looks like the following: <br clear="all">    </p>    <p class="paragraph">      <div class="code">        <div class="codeContent"><pre class="code-java">ServiceMix ESB: 1.0.1Loading ServiceMix from file: servicemix.xml[INFO] XmlBeanDefinitionReader - -Loading XML bean definitions from file [C:\Program Files\servicemix-1.0.1\examples\file-binding\servicemi.xml][INFO] FileSystemXmlApplicationContext - -Bean factory <span class="code-keyword">for</span> application context [org.springframework.context.support.FileSystemXmlApplicationContext;hashCode=7486844]: org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [workManager,jbi]; root of BeanFactory hierarchy[INFO] FileSystemXmlApplicationContext - -2 beans defined in application context[org.springframework.context.support.FileSystemXmlApplicationContext;hashCode=7486844][INFO] CollectionFactory - -JDK 1.4+ collections available[INFO] CollectionFactory - -Commons Collections 3.x available[INFO] FileSystemXmlApplicationContext - -Unable to locate MessageSource with name 'messageSource': using <span class="code-keyword">default</span> [org.springframework.context.support.DelegatingMessageSource@1d6776d][INFO] FileSystemXmlApplicationContext - -Unable to locate ApplicationEventMulticaster with name 'applicationEventMulticaster': using default [org.springframework.context.event.SimpleApplicationEventMulticaster@4fce71][INFO] DefaultListableBeanFactory - -Pre-instantiating singletons in factory [org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [workManager,jbi]; root of BeanFactory hierarchy][INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'workManager'[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'jbi'Created MBeanServer with ID: 203c31:106bd250a5b:-7fff:Lisas:1[INFO] SpringInitialContextFactory - -Loading JNDI context from: class path resource [jndi.xml][INFO] XmlBeanDefinitionReader - -Loading XML bean definitions from class path resource [jndi.xml][INFO] XmlBeanFactory - -Creating shared instance of singleton bean 'jndi'RMIConnectorServer started at: service:jmx:rmi:<span class="code-comment">//lisas/jndi/rmi://localhost:1099/defaultJBIJMX</span>[INFO] JBIContainer - -ServiceMix JBI Container (http:<span class="code-comment">//servicemix.org/) name: defaultJBI running version: ServiceMix.</span>[INFO] JBIContainer - -Activating component <span class="code-keyword">for</span>: [container=defaultJBI,name=fileSender,id=fileSender] with service: fileSender component: org.servicemix.components.file.FileWriter@b1cc87[INFO] ComponentContextImpl - -Component: fileSender activated endpoint: fileSender : fileSender[INFO] JBIContainer - -Activating component <span class="code-keyword">for</span>: [container=defaultJBI,name=filePoller,id=filePoller] with service: filePoller component: org.servicemix.components.file.FilePoller@183e7de[INFO] ComponentContextImpl - -Component: filePoller activated endpoint: filePoller : filePoller[INFO] DeliveryChannel - -<span class="code-keyword">default</span> destination serviceName <span class="code-keyword">for</span> filePoller = fileSender</pre></div>      </div>    </p>    <p>Note: In the <tt>servicemix.xml</tt> file, the &quot;destinationService&quot; attribute of the <em>filePoller</em> component is &quot;foo:fileSender.&quot; The last line of output (above) shows the NMR using that to deliver the normalized message to <em>fileSender</em>.</p>    <h3><a name="filebinding-Details"></a>Details</h3>    <p>The following table provides more details about the function of each component and bean in the <tt>servicemix.xml</tt> file. <br clear="all">      <br clear="all">    </p>    <p class="paragraph">      <table class="confluenceTable">        <tbody>          <tr>            <th class="confluenceTh"> Component or Bean ID </th>            <th class="confluenceTh"> Description </th>          </tr>          <tr>            <td class="confluenceTd"><em>filePoller</em></td>            <td class="confluenceTd"> This component periodically checks the &quot;inbox&quot; directory looking for files. If there is a file or directory present, it adds the file to the &quot;workingSet&quot;, which is a collection of files to be processed. The <em>workManger</em> is invoked to schedule the work of processing the file from the workingSet. Another thread is created and the processing of the file begins. Processing consists of marshalling the file (streaming it from disk into a normalized message). The normalized message is sent over the NMR to the <em>fileSender</em> component per the specified &quot;destinationService&quot;. The destinationService is specified in the <tt>servicemix.xml</tt> file as an attribute the <em>filePoller</em> component. In this example, the &quot;destinationService&quot; is the <em>fileSender</em> component. Finally, after it has been processed, the <em>filePoller</em> deletes the file from the source directory. </td>          </tr>          <tr>            <td class="confluenceTd"><em>fileSender</em></td>            <td class="confluenceTd"> This component is the &quot;destinationService&quot; for the <em>filePoller</em>. It receives normalized messages from <em>filePoller</em>. The messages it receives are the files that <em>filePoller</em>has transferred to it via the NMR. It converts the normalized message to its original file format and sends it to the destination directory, the <tt>outbox</tt> directory. This component creates the filename to which to copy the file by concatenating the string &quot;sample_&quot; with the process id following by &quot;.xml&quot;. The concatenated string is passed to the org.servicemix.expression.JaxenStringXPathExpression bean as an argument to the constructor, as can be seen by the <tt>constructor-arg value</tt> tag in the XML file. </td>          </tr>          <tr>            <td class="confluenceTd"><em>workManager</em></td>            <td class="confluenceTd"> This bean is used by the <em>filePoller</em> to increase the throughput of the application. The workManager is a thread pool whose size can be adjusted declaratively in the <tt>servicemix.xml</tt> file. The other components in the <em>File Binding</em> application ask the <em>workManager</em> for threads as needed. For example, threads are used by this application to periodically (every second) check for files in the <tt>inbox</tt>. Other threads are used to do the work of processing files (streaming them in, normalizing them, and sending them to the NMR). <em>Note:</em> The <em>fileSender</em> component also uses a thread to do its' work, however, it is not using a thread from the <em>workManager's</em> thread pool. </td>          </tr>        </tbody>      </table>    </p>    <h3><a name="filebinding-UsefulCodeHints"></a>Useful Code Hints</h3>    <p>This section describes the start-up sequence and how the ServiceMix container interacts with the <em>File Binding</em>application. The Java class files are located in the servicemix-1.0.1.jar file in the ServiceMix installation directory. To look at the Java source code, unjar and decompile the .class files or <span class="nobr"><a href="http://www.servicemix.org/Downloads" rel="nofollow">download</a></span> the source code. Please note: the downloadable source code is slightly different than the compiled binary code.</p>    <p>Viewing the Java source code is recommended for understanding the information in this section.</p>    <p><b><em>filePoller</em></b> <b>Details</b></p>    <p class="paragraph">      <ol>        <li>The ServiceMix container reads the <tt>servicemix.xml</tt> file and sees it needs to instantiate a <b>FilePoller</b>.</li>        <li>The container calls the init() method of <b>FilePoller</b>, as well as the init() methods of its parents.</li>        <li>The container determines that <b>FilePoller</b> is an MBean and, therefore, calls the start() method of <b>FilePoller</b>, which it inherits from its parent PollingComponentSupport.</li>        <li>The start() method will: (<b>See:</b> PollingComponentSupport.java code fragment below)<br> A. Create a timerTask.<br> B. Schedule the timerTask at a fixed rate. The start() method uses the &quot;timer&quot; (created in the init method) to schedule the timerTask at a fixed rate: timer.scheduleAtFixedRate(timerTask, firstTime, period). Recall &quot;period&quot; is a property of <b>FilePoller</b>. It was assigned the value of 1000ms by dependency injection from the <tt>servicemix.xml</tt> file.<br> C. timer will call the run() method of the timerTask periodically. timerTask's run method() is defined inline. This run() method will get the <b>workManager</b> object (see below for details).<br> D. The <b>workManager</b> will call &quot;scheduleWork(PollingComponentSupport.this)&quot;. _Note:_it passes in PollingComponent support, which by virtue of its inheritance hierarchy, is of type &quot;Work&quot;, which is a &quot;Runnable&quot; object.<br> E. &quot;workManager.scheduleWork(Work)&quot; will get a Thread, passing in a Runnable object, i.e. PollingComponentSupport, and call its run() method.<br> F. PollingComponent's run() method calls poll(), which is implemented in <b>FilePoller</b>.<br> G. From this point on the call sequence can be followed in <b>FilePoller</b>...<br> H. The start() method of PollingComponentSupport, will eventually call super.start(), which propagates up to call the start() method of BaseLifeCycle, which sets the component state to &quot;RUNNING.&quot;</li>      </ol>    </p>    <p>Eventually, one of the threads that is polling (see step G) for a file in the <tt>inbox</tt> directory will see a one. It will use <b>workManager's</b> thread pool to get a thread for processing the file. Processing the file consists of streaming it from <tt>inbox</tt>, creating a normalized message, and sending the message to the NMR.</p>    <p class="paragraph">      <div class="code" style="border-style: solid; ">        <div class="codeHeader" style="border-bottom-style: solid; "><b>PollingComponentSupport.java</b></div>        <div class="codeContent"><pre class="code-java"><span class="code-keyword">protected</span> void init() <span class="code-keyword">throws</span> JBIException {        <span class="code-keyword">if</span> (scheduler == <span class="code-keyword">null</span>) {            scheduler = <span class="code-keyword">new</span> Scheduler(<span class="code-keyword">true</span>);        }        <span class="code-keyword">if</span> (scheduleIterator == <span class="code-keyword">null</span>) {        	scheduleIterator = <span class="code-keyword">new</span> PollScheduleIterator();        }        <span class="code-keyword">if</span> (workManager == <span class="code-keyword">null</span>) {            ComponentContextImpl context = (ComponentContextImpl) getContext();            workManager = context.getWorkManager();        }        <span class="code-keyword">super</span>.init();           }</pre></div>      </div>    </p>    <p><b><em>workManager</em></b> <b>Details</b></p>    <p><em>workManager</em> is a property of the <b>FilePoller</b> object. This property is defined by a local reference, the &quot;ref&quot; attribute in the <tt>servicemix.xml</tt> file. The local reference is a bean which instantiates org.activemq.work.SpringWorkManager.</p>    <p>The SpringWorkManager is a Spring bean. By default when a Spring bean starts, the properties are set, and then the afterPropertiesSet() method is called by the container.</p>    <p>The <b>workManager</b> is used to allocate threads. The <b>FilePoller</b> asks for threads from the <b>workManager</b> for two operations:</p>    <p class="paragraph">      <ol>        <li>The timerTask uses threads from the thread pool to periodically check the <tt>inbox</tt> directory for files.</li>        <li>The <b>workManager</b> will also allocate a thread to process a file (read, normalize and send to NMR). The <b>workManager</b> calls a scheduleWork() method which is non-blocking. Therefore, if multiple files need to be processed, <b>FilePoller</b> can continue making requests to the <b>workManager</b> to schedule work.</li>      </ol>    </p>    <p>Summarizing, when the ServiceMix container instantiates an MBean it firsts sets the property values if there are any, then calls the init() method of the class and its' parent classes, if applicable. Then it calls the start() method of the class. When a Spring bean starts up, the properties are set and then the afterPropertiesSet() method is called.</p>    <h3><a name="filebinding-RelatedDocumentation"></a>Related Documentation</h3>    <p>For more information on the following topics please see:</p>    <ul>      <li><a href="Glossary#Glossary-NMR" title="NMR on Glossary">NMR</a></li>    </ul>    <ul>      <li><span class="nobr"><a href="http://www.servicemix.org/Spring+support" rel="nofollow">Spring</a></span></li>    </ul>    <p>      <br clear="all"> For a brief explanation of the XML tags in the <tt>servicemi.xml</tt> file, please see:</p>    <ul>      <li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix.xsd.html" rel="nofollow">XSD</a></span></li>    </ul>  </div></div>          &nbsp;        </td>      </tr>      <tr>        <td colspan="3" id="footer">          <table width="100%">             <tr>              <td align="left" valign="top">          Copyright 2004. All rights reserved unless otherwise noted.<br/>          Powered by <a href="http://atlassian.com/">Atlassian</a> <a href="http://atlassian.com/confluence/">Confluence</a>.              </td>              <td align="right" valign="top">          <a style="color:#999;" href="http://docs.codehaus.org/pages/editpage.action?spaceKey=SM&title=File+Binding">[ edit ]</a>              </td>            </tr>          <table>        </td>      </tr>    </table>  </body></html>