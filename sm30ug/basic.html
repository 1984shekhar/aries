
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <LINK type="text/css" rel="stylesheet" href="resources/site.css">
    <SCRIPT src="resources/space.js" type="text/javascript"></SCRIPT>
    <TITLE>
Basic
    </TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">

    <!-- Banner -->
    <DIV id="site-banner">
    </DIV>

      <DIV id="site-content">
        <TABLE>
        <TR>
        <TD valign="top">
          <DIV id="site-page">
            <DIV class="wiki-content"><STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="../SM/4-examples.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="../SM/4-examples.html">4. Examples</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="../SM/bridge.html">Bridge</A></TD><TD class="ScrollbarNextIcon"><A href="../SM/bridge.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="Basic-top"></A></P>

<H1><A name="Basic-BasicExample"></A>Basic Example</H1>


<H2><A name="Basic-Overview"></A>Overview</H2>

<P>This document describes how to run the <EM>Basic</EM> example and provides details about what it does. For information on the business use case, please refer to: <SPAN class="nobr"><A href="http://www.servicemix.org/Use%20Cases" title="Visit page outside Confluence" rel="nofollow">Use Case for Basic<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN>.
<BR clear="all">
<BR clear="all">
The Basic example illustrates the following:</P>
<UL>
	<LI>use of declarative programming</LI>
	<LI>how to use an <SPAN class="nobr"><A href="http://www.activemq.org/Spring%20Support" title="Visit page outside Confluence" rel="nofollow">ActiveMQ<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> message broker</LI>
	<LI>how to use a <SPAN class="nobr"><A href="http://www.servicemix.org/Quartz" title="Visit page outside Confluence" rel="nofollow">Quartz<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> timer</LI>
	<LI>how to use the <SPAN class="nobr"><A href="http://jencks.org/" title="Visit page outside Confluence" rel="nofollow">Jencks<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> JCA container</LI>
	<LI>how to use the <SPAN class="nobr"><A href="http://geronimo.apache.org/" title="Visit page outside Confluence" rel="nofollow">Geronimo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> Transaction Manager via the <SPAN class="nobr"><A href="http://jencks.org/Transaction%20Manager" title="Visit page outside Confluence" rel="nofollow">Jencks factory bean<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI>how to use tracing</LI>
</UL>


<P>The source code for the Basic example is located in the ServiceMix installation directory under the <TT>examples\basic\src\main\resources</TT> directory in the <TT>servicemix.xml</TT> file. It is recommended that you refer to the source code while reading this document.
<BR clear="all">
<BR clear="all">
There are several components in the <TT>servicemix.xml</TT>file. One component sets off a trigger to send messages to a source destination. Then those messages are consumed by another component and sent to a different output destination. A trace component displays the messages as they arrive.
<BR clear="all">
<BR clear="all"></P>

<H2><A name="Basic-RunningtheBasicExample"></A>Running the <EM>Basic</EM> Example</H2>

<P>From a command shell, go to the Basic example directory:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">cd [SM30UG:servicemix_install_dir]\examples\basic</PRE>
</DIV></DIV>
<P><BR clear="all">
Then type:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">mvn jbi:embeddedServicemix</PRE>
</DIV></DIV>
<P><BR clear="all">
<BR clear="all"></P>
<TABLE cellpadding="5" width="85%" cellspacing="8px" class="tipMacro" border="0" align="center"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://goopen.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B class="strong">Handy Hint</B><BR>
<P>This example start an ActiveMQ JMS Broker, so be sure to stop any ServiceMix server already running.</P></TD></TR></TABLE>

<H2><A name="Basic-StoppingtheBasicExample"></A>Stopping the <EM>Basic</EM> Example</H2>

<P>To terminate the Basic example type &quot;CTRL-C&quot; in the command shell in which it is running.
<BR clear="all"></P>

<H2><A name="Basic-HowitWorks"></A>How it Works</H2>

<P>The diagram below illustrates the flow of messages through the <EM>Basic</EM> components.
<BR clear="all">
<BR clear="all"></P>
<DIV class="panel" style="border-style: solid; border-color: #ccc; "><DIV class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><B>Basic Example Message Flow Diagram</B></DIV><DIV class="panelContent">
<P><DIV align="center"><IMG src="basic.data/basicflow1.jpg" border="0"></DIV><BR>
&nbsp;</P>
</DIV></DIV>
<P><BR clear="all">
<BR clear="all"></P>

<P>Messages flow through the components as follows:</P>
<OL>
	<LI>The <EM>timer</EM> component sends a message to <EM>inputSender</EM> through the Normalized Message Router (NMR).</LI>
	<LI><EM>inputSender</EM> converts the message (marshals it) into a JMS message, then uses the <EM>jmsTemplate</EM> bean to publish the message.</LI>
	<LI><EM>jmsTemplate</EM> uses the <EM>jmsFactory</EM>bean to get a connection to the port associated with the JMS topic called &quot;demo.org.servicemix.source.&quot; The message is published on the &quot;demo.org.servicemix.source&quot; topic.</LI>
	<LI><EM>jencks</EM> (the JCA resource adapter) listens on port 61616 for messages.</LI>
	<LI><EM>inputReceiver</EM> subscribes to the &quot;demo.org.servicemix.source&quot; topic via <EM>jencks</EM> and receives the JMS message.</LI>
	<LI><EM>inputReceiver</EM> normalizes the JMS message and sends it to <EM>outputSender</EM> via the NMR.</LI>
	<LI><EM>outputSender</EM> marshals the normalized message to a JMS message and uses <EM>jmsTemplate</EM> to publish the message on the &quot;demo.org.servicemix.result&quot; topic.</LI>
	<LI><EM>jmsTemplate</EM> publishes it on the &quot;demo.org.servicemix.result&quot; topic using <EM>jmsFactory</EM> to get a connection to the result topic.</LI>
	<LI><EM>jencks</EM> listens on port 61616 for messages.</LI>
	<LI><EM>jmsTrace</EM> subscribes to the &quot;demo.org.servicemix.result&quot; topic and receives the JMS message via <EM>jencks</EM>.</LI>
	<LI><EM>jmsTrace</EM> converts the JMS message into a normalized message and sends it to <EM>trace</EM> via the NMR.</LI>
	<LI><EM>trace</EM> transforms the normalized message into a string and logs it to the console.
<BR clear="all"></LI>
</OL>


<P>Every 5 seconds logging information is written to the console, followed by information from the trace component. Note, that the triggers&apos; property values of &quot;name&quot;, &quot;My Example Job&quot;, &quot;group&quot;, and &quot;ServiceMix&quot; are displayed along with a timestamp. Typical output looks like the following:
<BR clear="all"></P>
<DIV class="preformatted"><DIV class="preformattedContent">
<PRE>INFO  TraceComponent - Exchange: InOnly[
  id: ID:guillaumes-1927-1157464363171-19:11
  status: Active
  role: provider
  service: {http://servicemix.apache.org/demo/}trace
  endpoint: trace
  in: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
      &lt;timer&gt;
        &lt;name&gt;My Example Job&lt;/name&gt;
        &lt;group&gt;ServiceMix&lt;/group&gt;
        &lt;fullname&gt;ServiceMix.My Example Job&lt;/fullname&gt;
        &lt;description/&gt;
        &lt;fireTime&gt;Tue Sep 05 15:53:39 CEST 2006&lt;/fireTime&gt;
      &lt;/timer&gt;
</PRE>
</DIV></DIV>

<H2><A name="Basic-Details"></A>Details</H2>

<P>The following table provides more details about the function of each component and bean in the servicemix.xml file.
<BR clear="all">
<BR clear="all"></P>
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Component or Bean ID </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> <EM>jbi</EM> </TD>
<TD class="confluenceTd"> <EM>jbi</EM> is the &quot;id&quot; of the JBI container and provides the basic infrastructure services for the following components: <EM>timer</EM>, <EM>inputSender</EM>, <EM>inputReceiver</EM>, <EM>outputSender</EM>, <EM>jmsTrace</EM>, and <EM>trace</EM>.  During initialization, several singletons are instantiated: <EM>transactionManager</EM>, <EM>broker</EM>, <EM>jencks</EM>, <EM>jmsFactory</EM>, and <EM>jbi</EM>. After initialization, the components in the <EM>jbi</EM> container are activated, starting with the <EM>timer</EM> component. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>timer</EM> </TD>
<TD class="confluenceTd"> The <EM>timer</EM> component shows the use of the QuartzComponent class. Every 5 seconds, until the program is terminated, the timer component kicks off an instance of a SimpleTrigger, which is associated with an instance of JobDetail. The job has a property called &quot;name&quot; with a value of &quot;My Example Job&quot; and another property called &quot;group&quot; with a value of &quot;ServiceMix.&quot; The resulting message is converted to a normalized message and routed through the NMR. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>inputSender</EM> </TD>
<TD class="confluenceTd"> This is a component inside the JBI container. It receives the normalized message (the message from the trigger), converts it to a JMS message, and publishes it to the topic called demo.org.servicemix.source. It uses the <EM>jmsTemplate</EM>(1) bean to handle the publish. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>inputReceiver</EM> </TD>
<TD class="confluenceTd"> This component uses <EM>jencks</EM> , the JCA container, to listen on port 61616 for a JMS message on the topic called &quot;demo.org.servicemix.source.&quot; <EM>inputReceiver</EM> subscribes to the demo.org.servicemix.source topic. It takes the message, normalizes it, and routes it to <EM>outputSender</EM> via the NMR. This component combined with <EM>outputSender</EM> and supporting beans creates a JMS bridge between two topics. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>outputSender</EM> </TD>
<TD class="confluenceTd"> This component receives a normalized message from the NMR, marshals it into a JMS message using <EM>jmsTemplate</EM>, then publishes it on the ActiveMQ (JMS) topic called &quot;demo.org.servicemix.result.&quot; </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>jmsTrace</EM> </TD>
<TD class="confluenceTd"> This component uses <EM>jencks</EM> to subscribe to the &quot;demo.org.servicemix.result&quot; topic and get messages. It then marshals the message into a normalized message and routes it via the NMR to the <EM>trace</EM> component. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>trace</EM> </TD>
<TD class="confluenceTd"> Receives normalized messages from <EM>jmsTrace</EM> via the NMR. It transforms the normalized message into a string and logs it to the console. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>jencks</EM> </TD>
<TD class="confluenceTd"> The <EM>jencks</EM> bean defines a JCA container. The JCA container allows you to configure thread pool size, configure a transaction manager, and configure a resource adapter. In this example, the resource adapter is an ActiveMQ adapter, however, another JMS listener could be configured instead. This adapter listens on port 61616 for JMS messages. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>broker</EM> </TD>
<TD class="confluenceTd"> The <EM>broker</EM> bean uses the <TT>activemq.xml</TT> file to configure the message broker, which handles the JMS messages for the components that require JMS messaging services. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>transactionManager</EM> </TD>
<TD class="confluenceTd"> This bean is configured to be the default transaction manager for the <EM>jbi</EM> container. <EM>jencks</EM>is configured to use the default transaction manager. This transaction manager provides transactional services between the resource adapter (in this case the ActiveMQ resource adapter provided by the <EM>jencks</EM> JCA container) and components the <EM>jbi</EM> container. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>jmsFactory</EM> </TD>
<TD class="confluenceTd"> This bean listens on port 61616 and provides a pooled ActiveMQ connection. </TD>
</TR>
</TBODY></TABLE>
<P>1. <EM>jmsTemplate:</EM> JmsTemplate is a Spring component which hides the low level details when sending JMS messages. For additional information see: <SPAN class="nobr"><A href="http://docs.codehaus.org/display/ACTIVEMQ/Spring%20Support" title="Visit page outside Confluence" rel="nofollow">JmsTemplate<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN>. jmsTemplate is not a component in the <EM>jbi</EM> container. It is used by <EM>inputSender</EM> and <EM>outputSender</EM>.</P>

<H2><A name="Basic-Usecase"></A>Use case</H2>

<P>ServiceMix is an Enterprise Service Bus (ESB) that is based on the Java Business Integration (JBI) standard <SPAN class="nobr"><A href="http://www.jcp.org/en/jsr/detail?id=208" title="Visit page outside Confluence" rel="nofollow">JSR 208<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN>. The JBI-based design specifies a standards-based pluggable architecture with a JVM-based runtime component called the Normalized Message Router (NMR). The <EM>Basic</EM> example demonstrates how applications communicate via the ServiceMix ESB, and the role that the NMR can play in that communication. Similar techniques could be used to plug any  external <SUP>1</SUP> application or service into ServiceMix (e.g. SAP, Peoplesoft, spreadsheets, POJOs, Webservices and EJBs) and allow it to communicate with other external applications or components using ServiceMix itself.</P>

<P>A hypothetical business scenario, which extends the <EM>Basic</EM> Example, is that of a department store distributor. This distributor sells products from multiple wholesalers (suppliers) to various retailers (customers). The distributor presents a common interface for product ordering to each of its department store customers. However, the distributor must work with a different ordering interface for each wholesale suppliers for the products they are buying.</P>

<P>Using an ESB, the distributor has developed a number of components to receive department store orders and then dynamically route and transform these orders to the appropriate wholesaler. The order processing flow is described as follows:</P>
<OL>
	<LI>Using the distributor&apos;s web interface, a department store customer submits an order for multiple products. An HTTP request is sent to the <EM>OrderReceiver</EM>, an HTTP binding component (BC). <SUP>3</SUP></LI>
	<LI>The <EM>OrderReceiver</EM> sends the message to an <EM>OrderRouter</EM> service engine (SE) <SUP>4</SUP> component. This SE is responsible for parsing the order and deciding, based on the message content, which <EM>OrderTransformer</EM> should receive which part of the message (i.e., an order for a product).</LI>
	<LI>The <EM>OrderRouter</EM> publishes the orders to the appropriate message topics based on the message content. Specifically, the <EM>OrderRouter</EM> publishes the messages based on which wholesaler sells the item.</LI>
	<LI>The <EM>OrderTransformer</EM> is a service engine component, which modifies the message and puts it in a format which is readable by the wholesaler interface that will fulfill the order.</LI>
	<LI>Each <EM>OrderTransformer</EM> sends the modified message to the <EM>OrderProcessor</EM>.</LI>
	<LI>The <EM>OrderProcessor</EM> is a binding component that has two functions:<BR>
a. It places an order to the appropriate wholesaler through the wholesaler&apos;s Webservice or proprietary interface.<BR>
b. It also publishes a message about the order on a topic.</LI>
	<LI>The message on the topic is subsequently picked up by the <EM>BusinessMonitor</EM> component via the <EM>jmsTrace</EM> component.</LI>
	<LI>The <EM>BusinessMonitor</EM> component monitors the orders for quality assurance and business analytics, such as data mining.</LI>
</OL>


<P>The following diagram illustrates this:</P>
<DIV class="panel" style="border-style: solid; border-color: #ccc; "><DIV class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><B>Department Store Distributor&apos;s Order Processing System</B></DIV><DIV class="panelContent">
<P><DIV align="center"><IMG src="basic.data/basicflow_as_usecase.jpg" border="0"></DIV></P>
</DIV></DIV>
<OL>
	<LI><EM>External</EM> means the application is outside of the ESB.</LI>
	<LI><EM>Resource Adapter</EM>: a resource adapter provides connectivity between a specific external application and the ESB. In the <EM>Basic</EM> example the jencks container provides a JMS resource adapater.</LI>
	<LI><EM>Binding Component (BC)</EM>: a BC provides connectivity to applications that are external to the ESB.</LI>
	<LI><EM>Service Engine (SE)</EM>: a service engine provides business logic and transformation services to other components within the enterprise service bus.</LI>
</OL>


<H2><A name="Basic-RelatedDocumentation"></A>Related Documentation</H2>

<P>For more information on the following topics please see:</P>
<UL>
	<LI><SPAN class="nobr"><A href="http://www.activemq.org/Spring%20Support" title="Visit page outside Confluence" rel="nofollow">ActiveMQ related components, <EM>jmsFactory</EM>, <EM>jmsTemplate</EM>, <EM>broker</EM><SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<UL>
	<LI><SPAN class="nobr"><A href="http://jencks.org/" title="Visit page outside Confluence" rel="nofollow">JCA Container, <EM>jencks</EM><SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<UL>
	<LI><SPAN class="nobr"><A href="http://www.servicemix.org/Quartz" title="Visit page outside Confluence" rel="nofollow">Quartz timer<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<P>For a brief explanation of the XML tags in the <TT>servicemix.xml</TT> file, please see:</P>
<UL>
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/servicemix/xml-schemas.html" title="Visit page outside Confluence" rel="nofollow">XSD<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="../SM/4-examples.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="../SM/4-examples.html">4. Examples</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="../SM/bridge.html">Bridge</A></TD><TD class="ScrollbarNextIcon"><A href="../SM/bridge.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV></DIV>
          </DIV>
        </TD>
      </TR>
      </TABLE>     
      </DIV>
    </DIV>
    <DIV id="site-footer">
          Added by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnodet">Guillaume Nodet</A>,
    last edited by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnodet">Guillaume Nodet</A> on Nov 08, 2006
                  &nbsp;(<A href="http://goopen.org/confluence/pages/diffpages.action?pageId=13492&originalId=14642">view change</A>)
              
      (<A href="http://goopen.org/confluence/pages/editpage.action?pageId=13492">edit page</A>)
    </DIV>

  </BODY>

</HTML>