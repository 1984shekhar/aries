<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head profile="http://www.w3.org/2000/08/w3c-synd/#">
    <link rel="stylesheet" href="site.css" type="text/css"/>
    <title>ServiceMix - BPEL example</title>
</head>

<body>

  <table id="ulayout">
    <tr id="ulayout_top">
      <td colspan="2" valign="bottom">
        <table width="100%">
          <tr id="utop">
            <td id="utop_left">
              <a href="http://incubator.apache.org"><img src="http://incubator.apache.org/images/apache-incubator-logo.png" style="border: none;"/></a>
            </td>
            <td id="utop_right" style="text-align: right; vertical-align: middle;padding-right:10px;">
              <a href="http://incubator.apache.org/servicemix"><img src="images/logo.gif" alt="ServiceMix" class="spaceLogo" border="0"/></a>
            </td>
          </tr>
          <tr>
            <td colspan="2" id="uadvertising_top">
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <table id="utop_nav">
          <tr>
            <td align="left" valign="middle">
              <div id="ubreadcrumbs">
                <p>
                  <a href="">Home</a>
                                     		                  </p>
              </div>
            </td>
            <td align="right" valign="middle">
              <div id="uquicklinks">
                                  <p><a href="Download" title="Download">Download</a> | <span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/">JavaDocs</a></span> <span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/">Components</a></span> | <a href="Source" title="Source">Source</a> | <span class="nobr"><a href="http://docs.codehaus.org/pages/listpages.action?key=SM">Wiki</a></span> |<span class="nobr"><a href="irc://irc.codehaus.org/servicemix">IRC</a></span> | <span class="nobr"><a href="http://servlet.uwyn.com/drone/log/hausbot/servicemix">IRC Log</a></span> | <a href="Mailing+Lists" title="Mailing Lists">Mailing Lists</a> | <a href="Discussion+Forums" title="Discussion Forums">Discussion Forums</a> | <span class="nobr"><a href="http://issues.apache.org/activemq/browse/SM">Support</a></span></p>
                              </div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2"></td>
    </tr>
    <tr id="ulayout_middle">
      <td id="uleft">
        <div class="content">
                      <div class="section_3"><h3><a name="Navigation-Overview"></a>Overview</h3>

<ul class="alternate" type="square">
	<li><a href="Home" title="Home">Home</a></li>
	<li><a href="Introduction+to+ESB" title="Introduction to ESB">Introduction to ESB</a></li>
	<li><a href="Background+to+ServiceMix" title="Background to ServiceMix">Background to ServiceMix</a></li>
	<li><a href="News" title="News">News</a></li>
	<li><a href="FAQ" title="FAQ">FAQ</a></li>
	<li><a href="Download" title="Download">Download</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Community"></a>Community</h3>

<ul class="alternate" type="square">
	<li><span class="nobr"><a href="http://docs.codehaus.org/pages/listpages.action?key=SM">Wiki</a></span></li>
	<li><a href="Discussion+Forums" title="Discussion Forums">Discussion Forums</a></li>
	<li><a href="Mailing+Lists" title="Mailing Lists">Mailing Lists</a></li>
	<li><a href="Contributing" title="Contributing">Contributing</a></li>
	<li><a href="Team" title="Team">Team</a></li>
	<li><a href="Users" title="Users">Users</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Documentation"></a>Documentation</h3>

<ul class="alternate" type="square">
	<li><a href="Getting+Started" title="Getting Started">Getting Started</a></li>
	<li><a href="Running" title="Running">Running</a></li>
	<li><a href="Examples" title="Examples">Examples</a></li>
	<li><a href="Use+Cases" title="Use Cases">Use Cases</a></li>
	<li><a href="Configuration" title="Configuration">Configuration</a></li>
	<li><a href="Xml+Reference" title="Xml Reference">Xml Reference</a></li>
	<li><a href="Management" title="Management">Management</a></li>
	<li><a href="Architecture" title="Architecture">Architecture</a></li>
	<li><a href="Clustering" title="Clustering">Clustering</a></li>
	<li><a href="NMR+Flows" title="NMR Flows">NMR Flows</a></li>
	<li><a href="Articles" title="Articles">Articles</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Reference"></a>Reference</h3>

<ul class="alternate" type="square">
	<li><span class="nobr"><a href="http://java.sun.com/integration/1.0/docs/sdk/api/index.html">JBI API</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/">JavaDocs Core</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/">JavaDocs Components</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix-console/apidocs/">JavaDocs Console</a></span></li>
	<li><a href="Glossary" title="Glossary">Glossary</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Features"></a>Features</h3>

<ul class="alternate" type="square">
	<li><a href="Components" title="Components">Components</a></li>
	<li><a href="Routing" title="Routing">Routing</a></li>
	<li><a href="Transformation" title="Transformation">Transformation</a></li>
	<li><a href="Spring+Client+Toolkit" title="Spring Client Toolkit">Spring Client Toolkit</a></li>
	<li><a href="Client+API" title="Client API">Client API</a></li>
	<li><a href="POJO+support" title="POJO support">POJO support</a></li>
	<li><a href="Expressions" title="Expressions">Expressions</a></li>
	<li><a href="Component+helper+classes" title="Component helper classes">Component helper classes</a></li>
	<li><a href="Ant+Tasks" title="Ant Tasks">Ant Tasks</a></li>
	<li><a href="JMX+Console" title="JMX Console">JMX Console</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Integration"></a>Integration</h3>

<ul class="alternate" type="square">
	<li><a href="Spring+support" title="Spring support">Spring support</a></li>
	<li><a href="Geronimo+Integration" title="Geronimo Integration">Geronimo Integration</a></li>
	<li><a href="JBoss+Deployer" title="JBoss Deployer">JBoss Integration</a></li>
	<li><a href="Tomcat+Integration" title="Tomcat Integration">Tomcat Integration</a></li>
	<li><a href="JOnAS+Integration" title="JOnAS Integration">JOnAS Integration</a></li>
	<li><a href="JNDI+configuration" title="JNDI configuration">JNDI configuration</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-ServiceMixComponents"></a>ServiceMix Components</h3>

<ul class="alternate" type="square">
	<li><a href="BPEL" title="BPEL">BPEL</a></li>
	<li><a href="Cache" title="Cache">Cache</a></li>
	<li><a href="Drools" title="Drools">Drools</a></li>
	<li><a href="Email" title="Email">Email</a></li>
	<li><a href="File" title="File">File</a></li>
	<li><a href="FTP" title="FTP">FTP</a></li>
	<li><a href="Groovy" title="Groovy">Groovy</a></li>
	<li><a href="HTTP" title="HTTP">HTTP</a></li>
	<li><a href="Jabber" title="Jabber">Jabber</a></li>
	<li><a href="JAX+WS" title="JAX WS">JAX WS</a></li>
	<li><a href="JCA" title="JCA">JCA</a></li>
	<li><a href="JMS" title="JMS">JMS</a></li>
	<li><a href="Quartz" title="Quartz">Quartz</a></li>
	<li><a href="Reflection" title="Reflection">Reflection</a></li>
	<li><a href="RSS" title="RSS">RSS</a></li>
	<li><a href="SAAJ" title="SAAJ">SAAJ</a></li>
	<li><a href="Scripting" title="Scripting">Scripting</a></li>
	<li><a href="ServiceMix" title="ServiceMix">ServiceMix</a></li>
	<li><a href="Validation" title="Validation">Validation</a></li>
	<li><a href="XFire" title="XFire">XFire</a></li>
	<li><a href="XPath+Router" title="XPath Router">XPath Router</a></li>
	<li><a href="XSLT" title="XSLT">XSLT</a></li>
	<li><a href="XSQL" title="XSQL">XSQL</a></li>
	<li><a href="VFS" title="VFS">VFS</a></li>
	<li><a href="WSIF" title="WSIF">WSIF</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Tooling"></a>Tooling</h3>

<ul class="alternate" type="square">
	<li><a href="Visualisation" title="Visualisation">Visualisation</a></li>
	<li><a href="Eclipse+plugin" title="Eclipse plugin">Eclipse plugin</a></li>
	<li><a href="JBoss+Deployer" title="JBoss Deployer">JBoss Deployer</a></li>
	<li><a href="WAR+Deployment" title="WAR Deployment">WAR Deployment</a></li>
	<li><a href="Maven+JBI+plugin" title="Maven JBI plugin">Maven JBI plugin</a></li>
	<li><a href="Maven+SAR+plugin" title="Maven SAR plugin">Maven SAR plugin</a></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-OtherJBIsoftware"></a>Other JBI software</h3>

<ul class="alternate" type="square">
	<li><span class="nobr"><a href="http://incubator.apache.org/projects/ode.html">Apache ODE</a></span></li>
	<li><span class="nobr"><a href="http://forge.objectweb.org/projects/celtix/">Celtix</a></span></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-RelatedProjects"></a>Related Projects</h3>

<ul class="alternate" type="square">
	<li><span class="nobr"><a href="http://activemq.codehaus.org/">ActiveMQ</a></span></li>
	<li><span class="nobr"><a href="http://jencks.org/">Jencks</a></span></li>
	<li><span class="nobr"><a href="http://lingo.codehaus.org/">Lingo</a></span></li>
	<li><span class="nobr"><a href="http://activesoap.codehaus.org/">ActiveSOAP</a></span></li>
	<li><span class="nobr"><a href="http://www.springframework.org/">Spring</a></span></li>
	<li><span class="nobr"><a href="http://geronimo.apache.org/">Geronimo</a></span></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Support"></a>Support</h3>

<ul class="alternate" type="square">
	<li><span class="nobr"><a href="http://issues.apache.org/activemq/browse/SM">Issues</a></span></li>
	<li><span class="nobr"><a href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:roadmap-panel">Roadmap</a></span></li>
	<li><span class="nobr"><a href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:changelog-panel">Change log</a></span></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Developers"></a>Developers</h3>

<ul class="alternate" type="square">
	<li><a href="Source" title="Source">Source</a></li>
	<li><a href="Roadmap" title="Roadmap">Roadmap</a></li>
	<li><a href="Ideas" title="Ideas">Ideas</a></li>
	<li><a href="Becoming+a+committer" title="Becoming a committer">Becoming a committer</a></li>
	<li><a href="Release+Guide" title="Release Guide">Release Guide</a></li>
	<li><span class="nobr"><a href="http://ci.codehaus.org/beetlejuice/viewProjectSummary.action?projectName=ServiceMix">BeetleJuice</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/clover/">Clover Report</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/xref/index.html">Source XRef</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/xref-test/index.html">Test Source XRef</a></span></li>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix.xsd.html">XSD</a></span></li>
</ul>


</div><div class="section_3"><h3><a name="Navigation-Toolsweuse"></a>Tools we use</h3>

<p><span class="nobr"><a href="http://www.yourkit.com"><img src="http://incubator.apache.org/servicemix/download/attachments/25208/yourkit.jpg" align="absmiddle" border="0"/></a></span></p></div>
          
          <div class="section_3">
            <h3>Feeds</h3>
            <ul class="feedList">
              <li><a class="rss" href="http://docs.codehaus.org/spaces/rss.action?key=SM&amp;newPages=false">Site</a></li>
              <li><a class="rss" href="http://docs.codehaus.org/spaces/blogrss.action?key=SM">News</a></li>
            </ul>
          </div>
        </div>
      </td>
      <td id="umain">
        <div class="content">
          
          <div id="upage_title">BPEL example</div>
          <div id="uads">


<center>

</center>

          </div>
          <div class="section_3"><h3><a name="BPELexample-OverviewoftheServiceMix1.xBPELExample"></a>Overview of the ServiceMix 1.x <em>BPEL</em> Example</h3>

<p>This document describes how to run ServiceMix's <em>BPEL</em> example and provides details about what it does. For information on the business use case, please refer to: <span class="nobr"><a href="http://www.servicemix.org/Use+Cases">Use Case for BPEL</a></span>.</p>

<p>The <em>BPEL</em> example illustrates the following:</p>
<ul>
	<li>an example of declarative programming</li>
	<li>how to perform <em>BPEL</em> integration with ServiceMix</li>
	<li>how to use <em>JmsTemplate</em> for publishing and subscribing to ActiveMQ topics</li>
</ul>


<p>The XML code for the <em>BPEL</em> example is located in the ServiceMix installation directory under the <tt>examples\bpel</tt> directory in the <tt>servicemix.xml</tt> file. It is recommended that you refer to the <tt>servicemix.xml</tt> file while reading this document.</p>

<p>This example has a client application, <em>JMSClient</em>, which sends a SOAP message to a ServiceMix binding component called <em>myComponent</em>. <em>myComponent</em> forwards the request to the PXE BPEL engine and waits for a response. In other words, <em>JMSClient</em> places a book order and <em>myComponent</em> receives the order and then sends it to the Webservice that takes orders. The client, <em>JMSClient</em>, and the binding component, <em>myComponent</em>, communicate via JMS; this communication is external to the ServiceMix JBI. <em>myComponent</em> and the PXE BPEL service engine communicate internally over the Normalized Message Router (NMR).</p>

</div><div class="section_3"><h3><a name="BPELexample-PrerequisitestoRuntheBPELExample"></a>Prerequisites to Run the <em>BPEL</em> Example</h3>

<p>The following must be installed to run this example:</p>
<ul>
	<li>Java Standard Edition 5.0</li>
	<li>Ant - <span class="nobr"><a href="http://ant.apache.org">http://ant.apache.org</a></span></li>
	<li>PXE - We support <span class="nobr"><a href="http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wsbpel">WS-BPEL</a></span> via the <span class="nobr"><a href="http://pxe.fivesight.com">PXE BPEL Engine</a></span> from <span class="nobr"><a href="http://www.fivesight.com">FiveSight</a></span>.
<br clear="all"/>
<br clear="all"/>
<table cellpadding="5" width="85%" cellspacing="8px" class="warningMacro" border="0" align="center"><colgroup><col width="24"/><col/></colgroup><tr><td valign="top"><img src="http://docs.codehaus.org/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"/></td><td><b class="strong">Warning</b><br/>
<p><b>NOTE:</b> ServiceMix works on any Java SE 1.4 or later environment; however to use PXE a Java SE 5 or later platform is required. Before running this example, use Java 1.5 to start up ServiceMix.</p></td></tr></table></li>
</ul>


</div><div class="section_3"><h3><a name="BPELexample-RunningtheBPELExample"></a>Running the <em>BPEL</em> Example</h3>

<p>Before running this example, the following setup must be done. PXE has a JBI component and deployment unit, which can be auto-deployed in any JBI compliant container, in this case ServiceMix. To use PXE with ServiceMix, the PXE deployment unit must be placed in the <tt>install</tt> directory so it will be auto-deployed in ServiceMix. <b>NOTE:</b> The PXE deployment unit has already been placed into the <tt>install</tt> directory for you - take a look at the <tt>servicemix_install_dir\examples\bpel\install</tt> directory to see the PXE jar file.</p>

<p>Perform the following steps to run the <em>BPEL</em> example:</p>
<ol>
	<li>From a command shell, go to the <em>BPEL</em> example directory:
<div class="code"><div class="codeContent">
<pre class="code-java">cd [servicemix_install_dir]\examples\bpel</pre>
</div></div>
<p>where <tt>servicemix_install_dir</tt> is the directory in which ServiceMix was installed.</p></li>
	<li>Then type:
<div class="code"><div class="codeContent">
<pre class="code-java">[servicemix_install_dir]\bin\servicemix servicemix.xml

OR

..\..\bin\servicemix servicemix.xml</pre>
</div></div>
<p><br clear="all"/></p></li>
	<li>To trigger the BPEL business process, send it some messages. To do this, compile and run a simple JMS client. The client is built and run from source code using Ant. Execute Ant from the <em>BPEL</em> directory: <tt>servicemix_install_dir\examples\bpel</tt>. To run the JMS client type:
<br clear="all"/>
<div class="code"><div class="codeContent">
<pre class="code-java">ant</pre>
</div></div>
<p><br clear="all"/>
Ant will compile and run the simple JMS client, <em>JMSClient</em>, which performs a JMS based request-response into the ServiceMix container before returning the results to the console.
<br clear="all"/></p>
<table cellpadding="5" width="85%" cellspacing="8px" class="tipMacro" border="0" align="center"><colgroup><col width="24"/><col/></colgroup><tr><td valign="top"><img src="http://docs.codehaus.org/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"/></td><td><b class="strong">Handy Hint</b><br/>
<p>Add <em>$SERVICEMIX_HOME\bin</em> directory to <em>$PATH</em> variable to simplify execution of the example.</p></td></tr></table></li>
</ol>


</div><div class="section_3"><h3><a name="BPELexample-StoppingtheBPELExample"></a>Stopping the <em>BPEL</em> Example</h3>

<p>To terminate the <em>BPEL</em> example type "CTRL-C" in the command shell in which it is running and answer "y" to the "Terminate batch job (y/n)?" question.
<br clear="all"/></p>

</div><div class="section_3"><h3><a name="BPELexample-HowitWorks"></a>How it Works</h3>

<p>The diagram below illustrates the logical flow of the program through the <em>BPEL</em> components:</p>

<p><br clear="all"/>
<br clear="all"/></p>
<div class="panel" style="border-style: solid; border-color: #ccc; "><div class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><b>BPEL Logical Flow Diagram</b></div><div class="panelContent">
<p><div align="center"><img src="http://incubator.apache.org/servicemix/download/attachments/29316/bpelflow.jpg" border="0"/></div></p>
</div></div>
<p><br clear="all"/>
<br clear="all"/></p>

<p>The logical flow of the program is:</p>
<ol>
	<li>The <em>JMSClient</em>, through ActiveMQConnectionFactory, connects to the topic named "demo.org.servicemix.source" and sends a text message containing the <tt>message.soap</tt> file.</li>
	<li><em>myComponent</em>, being a subscriber of the topic "demo.org.servicemix.source," receives the message.</li>
	<li>The <em>myComponent</em> implementation class, JmsServiceComponent, sends the message over the ServiceMix bus to the <em>PxeBpelEngine</em> by executing its onMessage() method. The destinationService property defines the destination of the message. <b>NOTE:</b> the destinationService property is found in the <tt>servicemix.xml</tt> file.</li>
	<li><em>PxeBpelEngine</em> sends a response back to <em>myComponent</em> through the ServiceMix bus, the NMR.</li>
	<li><em>myComponent</em> uses the <em>jmsTemplate</em> bean to publish the message.</li>
	<li><em>jmsTemplate</em> uses the <em>jmsFactory</em> bean to get a connection to the port associated with the JMS topic called "demo.org.servicemix.source." The message is published on the "demo.org.servicemix.source" topic.</li>
	<li><em>JMSClient</em>, being a subscriber of topic "demo.org.servicemix.source," receives the message.</li>
	<li>The response is printed on the console.</li>
</ol>


<p>Typical output looks like the following:
<br clear="all"/></p>
<div class="code"><div class="codeContent">
<pre class="code-java">ServiceMix ESB: 1.0

Loading ServiceMix from file: servicemix.xml
[INFO] XmlBeanDefinitionReader - -Loading XML bean definitions from file C:\exist\servicemix\servicemix-1.0.1\examples\bpel\servicemix.xml]
[INFO] CollectionFactory - -JDK 1.4+ collections available
[INFO] CollectionFactory - -Commons Collections 3.x available
[INFO] FileSystemXmlApplicationContext - -Bean factory <span class="code-keyword">for</span> application context
[org.springframework.context.support.FileSystemXmlApplicationContext;hashCode=110
2920]: org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans
[jndi,broker,transactionManager,jmsFactory,jbi];
 root of BeanFactory hierarchy[INFO] FileSystemXmlApplicationContext - -5 beans defined in application context
 [org.springframework.context.support.FileSystemXmlApplicationContext;hashCode=1102920]
[INFO] FileSystemXmlApplicationContext - -Unable to locate MessageSource with name 'messageSource': using <span class="code-keyword">default</span>
[org.springframework.context.support.DelegatingMessageSource@18e2b22]
[INFO] FileSystemXmlApplicationContext - -Unable to locate ApplicationEventMulticaster with name 'applicationEventMulticaster':
using <span class="code-keyword">default</span> [org.springframework.context.event.SimpleApplicationEventMulticaster@13caecd]
[INFO] DefaultListableBeanFactory - -Pre-instantiating singletons in factory
 [org.springframework.beans.factory.support.DefaultListableBeanFactory
defining beans [jndi,broker,transactionManager,jmsFactory,jbi]; root of BeanFactory hierarchy]
[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean'jndi'
[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'broker'
[INFO] SpringBrokerContainerFactory - -Loading ActiveMQ broker from configuration: class path resource [activemq.xml]
[INFO] ActiveMQBeanDefinitionReader - -Loading XML bean definitions from class path resource [activemq.xml]
[INFO] ActiveMQBeanFactory - -Creating shared instance of singleton bean 'broker'
[INFO] ActiveMQBeanFactory - -Creating shared instance of singleton bean 'memoryManager'
[INFO] ActiveMQBeanFactory - -Creating shared instance of singleton bean 'derby-ds'
[INFO] ActiveMQBeanFactory - -Creating shared instance of singleton bean 'mysql-ds'
[INFO] BrokerContainerImpl - -ActiveMQ 3.1-M6 JMS Message Broker (ID:el2tong-1095-1129854563062-0:0) is starting
[INFO] BrokerContainerImpl - -For help or more information please see: http:<span class="code-comment">//www.logicblaze.com
</span>[INFO] JDBCPersistenceAdapter - -Database driver recognized: [apache_derby_embedded_jdbc_driver]
[INFO] DefaultJDBCAdapter - -Could not create JDBC tables; they could already exist. Failure was:
CREATE TABLE ACTIVEMQ_MSGS(ID INTEGER NOT NULL, CONTAINER VARCHAR(250), MSGID VARCHAR(250), MSG BLOB, PRIMARY KEY ( ID ) )
Message: Table/View 'ACTIVEMQ_MSGS' already exists in Schema 'APP'. SQLState: X0Y32 Vendor code: 20000
[INFO] DefaultJDBCAdapter - -Could not create JDBC tables; they could already exist. Failure was:
CREATE TABLE ACTIVEMQ_TXS(XID VARCHAR(250) NOT NULL, PRIMARY KEY ( XID )) Message: Table/View 'ACTIVEMQ_TXS' already exists in Schema 'APP'. SQLState: X0Y32 Vendor code: 20000
[INFO] DefaultJDBCAdapter - -Could not create JDBC tables; they could already exist. Failure was:
CREATE TABLE ACTIVEMQ_ACKS(SUB VARCHAR(250) NOT NULL, CONTAINER VARCHAR(250) NOT NULL, LAST_ACKED_ID INTEGER, SE_ID INTEGER,
SE_CLIENT_ID VARCHAR(250), SE_CONSUMER_NAME VARCHAR(250), SE_SELECTOR VARCHAR(250), PRIMARY KEY (
 SUB, CONTAINER )) Message: Table/View 'ACTIVEMQ_ACKS' already exists in Schema 'APP'. SQLState: X0Y32 Vendor code: 20000
[INFO] DefaultJDBCAdapter - -Could not create JDBC tables; they could already exist. Failure was:
ALTER TABLE ACTIVEMQ_MSGS ADD EXPIRATION BIGINT Message: Column 'EXPIRATION' already exists in Table/View 'APP.ACTIVEMQ_MSGS'. SQLState: X0Y32 Vendor code: 20000
[INFO] JournalPersistenceAdapter - -Opening journal.
[INFO] JournalPersistenceAdapter - -Opened journal: Active Journal: using 2 x 20.0 Megs at: ..\<span class="code-keyword">var</span>\journal
[INFO] JournalPersistenceAdapter - -Journal Recovery Started.
[INFO] JournalPersistenceAdapter - -Journal Recovered: 0 message(s) in transactions recovered.
[INFO] TcpTransportServerChannel - -Listening <span class="code-keyword">for</span> connections at: tcp:<span class="code-comment">//el2tong:61616
</span>[INFO] BrokerConnectorImpl - -ActiveMQ connector started: TcpTransportServerChannel@tcp:<span class="code-comment">//el2tong:61616
</span>[INFO] BrokerContainerImpl - -ActiveMQ JMS Message Broker (ID:el2tong-1095-1129854563062-0:0) has started
[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'transactionManager'
[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'jmsFactory'
[INFO] DefaultListableBeanFactory - -Creating shared instance of singleton bean 'jbi'
[INFO] ActiveMQConnection - -channel status changed: Channel: TcpTransportChannel: Socket[addr=localhost/127.0.0.1,port=61616,localport=1096] has connected
[INFO] BrokerContainerImpl - -Adding <span class="code-keyword">new</span> client: ID:el2tong-1095-1129854563062-5:0 on transport: TcpTransportChannel: Socket[addr=/127.0.0.1,port=1096,localport=61616]
[INFO] JBIContainer - -ServiceMix JBI Container (http:<span class="code-comment">//servicemix.org/) name: defaultJBI running version: ServiceMix.
</span>[INFO] JBIContainer - -Activating component <span class="code-keyword">for</span>: [container=defaultJBI,name=myComponent,id=myComponent]
 with service: {uri:fivesight.com/examples/AsyncProcessJBI}JmsService component: org.servicemix.components.jms.JmsServiceComponent@1b82d69
[INFO] ComponentContextImpl - -Component: myComponent activated endpoint: {uri:fivesight.com/examples/AsyncProcessJBI}JmsService : myComponent</pre>
</div></div>

</div><div class="section_3"><h3><a name="BPELexample-Details"></a>Details</h3>

<p>The following table provides more details about the function of each component and bean in the <tt>servicemix.xml</tt> file:
<br clear="all"/>
<br clear="all"/></p>
<table class="confluenceTable"><tbody>
<tr>
<th class="confluenceTh"> Component or Bean ID </th>
<th class="confluenceTh"> Description </th>
</tr>
<tr>
<td class="confluenceTd"> <em>jbi</em> </td>
<td class="confluenceTd"> jbi is the "id" of the JBI container and provides the basic infrastructure services for <em>myComponent</em>. During initialization, several singletons are instantiated: <em>transactionManager</em>, <em>broker</em>, <em>jmsFactory</em>, and <em>jbi</em>. Also, take note of the properties installationDirPath and deploymentDirPath defined in <tt>servicemix.xml</tt>. ServiceMix automatically installs components found in the folder specified in the installationDirPath property. It automatically deploys component-specific artifacts found in the folder specified in the deploymentDirPath property. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>JMSClient</em> </td>
<td class="confluenceTd"> This Java standalone program, through the ActiveMQConnectionFactory, connects to topic "demo.org.servicemix.source." It then creates a text message from the file <tt>message.soap</tt> and publishes it to the topic "demo.org.servicemix.source," then requests and waits for a response. It eventually prints the response to the console. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>myComponent</em> </td>
<td class="confluenceTd"> This JMS service component subscribes to the "demo.org.servicemix.source" topic via its defaultDestinationName property specified in the <tt>servicemix.xml</tt> configuration file. Through its template property, it uses <em>jmsFactory</em> to listen on port 61616 via ActiveMQConnectionFactory. It is implemented by the <em>JmsServiceComponent</em> that has an onMessage() method which is called by ActiveMQ when a message arrives on the topic. This method creates a normalized message, which is sent over the ServiceMix bus to the PxeBpelEngine as specified on its destinationService property. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>jndi</em> </td>
<td class="confluenceTd"> This bean loads up database and transaction manager resources, which will be used by the other components in the system. More importantly, the JNDI context must be configured so that PXE can be deployed. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>Pxe-install.jar</em> </td>
<td class="confluenceTd"> This jarfile is located in the <tt>examples\bpel\install</tt> directory. It contains many files, which in turn contain the classes that implement the PXE BPEL engine. It also has a <tt>jbi.xml</tt> file, which is used by ServiceMix to install the PXE BPEL engine as a ServiceMix service-engine component. Note, that in this file the component type is "service-engine" and the component name is <em>PxeBpelEngine</em>. When processes are deployed to the PXE engine (see next row with AsyncProcess-sa.jar), it exposes them as services on the JBI, which can be referenced by other components as destinationService(s), with destinationEnpoint(s) - see the <tt>servicemix.xml</tt> file. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>AsyncProcess-sa.jar</em> </td>
<td class="confluenceTd"> This jarfile is located in the <tt>examples\bpel\deploy</tt> directory. It contains a <tt>jbi.xml</tt> file, which references the <em>PxeBpelEngine</em>. This ties the processes to the PXE engine described in the previous section. The <tt>jbi.xml</tt> file also references the <tt>AsyncProcess-su.zip</tt> file, which is also contained in the <em>AsycnProcess-sa.jar</em> file. This zipfile contains other configuration files and WSDL files, i.e., <tt>pxe-system.xml</tt> and <tt>resource_X.stream</tt>, which describe the services deployed on the PXE engine. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>broker</em> </td>
<td class="confluenceTd"> The broker bean uses the <tt>activemq.xml</tt> file to configure the message broker, which handles the JMS messages for the components that require JMS messaging services. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>transactionManager</em> </td>
<td class="confluenceTd"> This bean is configured to be the default transaction manager for the jbi container. This transaction manager provides transactional services between the resource adapter (in this case the ActiveMQ resource adapter provided by the jencks JCA container) and components in the jbi container. </td>
</tr>
<tr>
<td class="confluenceTd"> <em>jmsFactory</em> </td>
<td class="confluenceTd"> This bean listens on port 61616 and provides a pooled ActiveMQ connection. </td>
</tr>
</tbody></table>

</div><div class="section_3"><h3><a name="BPELexample-RelatedDocumentation"></a>Related Documentation</h3>

<p>For more information on the following topics please see:</p>
<ul>
	<li><span class="nobr"><a href="http://www.activemq.org/Spring+Support">ActiveMQ related components, jmsFactory, jmsTemplate, broker</a></span></li>
</ul>


<ul>
	<li><a href="Glossary#Glossary-NMR" title="NMR on Glossary">NMR</a></li>
</ul>


<ul>
	<li><span class="nobr"><a href="http://pxe.fivesight.com">PXE BPEL Engine</a></span></li>
</ul>


<ul>
	<li><span class="nobr"><a href="http://www.servicemix.org/Spring+support">Spring</a></span></li>
</ul>


<p>For a brief explanation of the XML tags in the <tt>servicemix.xml</tt> file, please see:</p>
<ul>
	<li><span class="nobr"><a href="http://servicemix.codehaus.org/maven/servicemix.xsd.html">XSD</a></span></li>
</ul>
</div>
        </div>
<div style="text-align: center; width: 100%; padding-top: 1cm;padding-bottom: 1cm">


</div>
</td>
    <tr>
    <tr id="ulayout_bottom">
      <td colspan="2" id="ufooter">
        <div class="content">
          
          
          <div>
            <a class="editPage" href="http://docs.codehaus.org/pages/editpage.action?spaceKey=SM&amp;title=BPEL+example"><img src="http://www.codehaus.org/edit.gif" border="0">[&nbsp;edit&nbsp;]</a>
          </div>
        </div>
      </td>
    </tr>
  </table>
</html>
