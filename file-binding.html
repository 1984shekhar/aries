
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
<!--
    Pier's plugin always overwrites the stylesheet so lets explicitly use another one
    <link type="text/css" rel="stylesheet" href="autoexport:///SM/resources/space.css">
-->
    <LINK type="text/css" rel="stylesheet" href="resources/site.css">
    <SCRIPT src="resources/space.js" type="text/javascript"></SCRIPT>
    <SCRIPT src="http://www.google-analytics.com/urchin.js" type="text/javascript">
    </SCRIPT>
    <SCRIPT type="text/javascript">
_uacct = "UA-398545-1";
urchinTracker();
    </SCRIPT>
    <TITLE>
File Binding
    </TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">

    <!-- Banner -->
    <DIV id="site-banner">

      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" class="topbardiv" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/servicemix/images/logo.jpg">
          </TD>
          <TD align="right" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/images/apache-incubator-logo.png">
          </TD>
        </TR> 
      </TABLE>

    </DIV>

    <!-- Bread crumbs and Quick Links -->
    <DIV id="site-navbar">
      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" valign="middle" nowrap="">
            <DIV id="site-breadcrumbs">
<A href="home.html" title="ServiceMix">ServiceMix</A>&nbsp;&gt;&nbsp;<A href="home.html" title="Home">Home</A>&nbsp;&gt;&nbsp;<A href="users-guide.html" title="User's Guide">User&apos;s Guide</A>&nbsp;&gt;&nbsp;<A href="4-examples.html" title="4. Examples">4. Examples</A>&nbsp;&gt;&nbsp;<A href="" title="File Binding">File Binding</A>
            </DIV>
          </TD>
          <TD align="right" valign="middle" nowrap="">
            <DIV id="site-quicklinks">
<P><A href="download.html" title="Download">Download</A> &#124; <A href="documentation.html" title="Documentation">Documentation</A> &#124; <A href="javadocs.html" title="JavaDocs">JavaDocs</A> &#124; <A href="source.html" title="Source">Source</A> &#124; <SPAN class="nobr"><A href="home.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A> &#124; <A href="support.html" title="Support">Support</A></P>
            </DIV>
          </TD>
        </TR> 
      </TABLE>
    </DIV>

<!-- Integrate google search later.
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF- 8" />
            <input type="hidden" name="oe" value="UTF- 8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
-->

      <DIV id="site-content">
        <TABLE>
        <TR>
        <TD valign="top">
          <DIV id="site-navigation">
<H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="home.html" title="Home">Home</A></LI>
	<LI><SPAN class="nobr"><A href="http://www.apache.org/" title="Visit page outside Confluence" rel="nofollow">ASF<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="license.html" title="License">License</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
	<LI><A href="sitemap.html" title="SiteMap">SiteMap</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="users-guide.html" title="User's Guide">User&apos;s Guide</A></LI>
	<LI><A href="documentation.html" title="Documentation">Documentation</A></LI>
	<LI><A href="support.html" title="Support">Support</A></LI>
	<LI><A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM" title="Visit page outside Confluence" rel="nofollow">Issues<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="contributing.html" title="Contributing">Contributing</A></LI>
	<LI><SPAN class="nobr"><A href="http://goopen.org/confluence/pages/listpages-dirview.action?key=SM" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="users.html" title="Users">Users</A></LI>
</UL>


<H3><A name="Navigation-Developers"></A>Developers</H3>

<UL class="alternate" type="square">
	<LI><A href="source.html" title="Source">Source</A></LI>
	<LI><A href="building.html" title="Building">Building</A></LI>
	<LI><A href="ideas.html" title="Ideas">Ideas</A></LI>
	<LI><A href="becoming-a-committer.html" title="Becoming a committer">Becoming a committer</A></LI>
	<LI><A href="release-guide.html" title="Release Guide">Release Guide</A></LI>
	<LI><A href="related-projects.html" title="Related Projects">Related Projects</A></LI>
	<LI><A href="tools.html" title="Tools">Tools</A></LI>
	<LI><A href="resources.html" title="Resources">Resources</A></LI>
</UL>


<H3><A name="Navigation-Components"></A>Components</H3>

<UL class="alternate" type="square">
	<LI><A href="servicemix-bean.html" title="servicemix-bean">servicemix&#45;bean</A></LI>
	<LI><A href="servicemix-bpe.html" title="servicemix-bpe">servicemix&#45;bpe</A></LI>
	<LI><A href="servicemix-drools.html" title="servicemix-drools">servicemix&#45;drools</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">servicemix&#45;eip</A></LI>
	<LI><A href="servicemix-file.html" title="servicemix-file">servicemix&#45;file</A></LI>
	<LI><A href="servicemix-ftp.html" title="servicemix-ftp">servicemix&#45;ftp</A></LI>
	<LI><A href="servicemix-http.html" title="servicemix-http">servicemix&#45;http</A></LI>
	<LI><A href="servicemix-jms.html" title="servicemix-jms">servicemix&#45;jms</A></LI>
	<LI><A href="servicemix-jsr181.html" title="servicemix-jsr181">servicemix&#45;jsr181</A></LI>
	<LI><A href="servicemix-lwcontainer.html" title="servicemix-lwcontainer">servicemix&#45;lwcontainer</A></LI>
	<LI><A href="servicemix-saxon.html" title="servicemix-saxon">servicemix&#45;saxon</A></LI>
	<LI><A href="servicemix-script.html" title="servicemix-script">servicemix&#45;script</A></LI>
	<LI><A href="servicemix-wsn2005.html" title="servicemix-wsn2005">servicemix&#45;wsn2005</A></LI>
	<LI><A href="servicemix-xmpp.html" title="servicemix-xmpp">servicemix&#45;xmpp</A></LI>
</UL>


          </DIV>
        </TD>
        <TD valign="top">
          <DIV id="site-page">

<!--          
            <div class="pagetitle">File Binding</div>
-->
            <DIV class="wiki-content"><STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="cluster.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="cluster.html">Cluster</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-examples.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-examples.html">4. Examples</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="loan-broker.html">Loan Broker</A></TD><TD class="ScrollbarNextIcon"><A href="loan-broker.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>

<H1><A name="FileBinding-FileBindingExample"></A>File Binding Example</H1>


<H2><A name="FileBinding-Overview"></A>Overview</H2>

<P>This document describes how to run ServiceMix&apos;s <EM>File Binding</EM> example and provides details about what it does. For information on the business use case, please refer to the last section: <A href="/confluence/display/SM30UG" title="View ServiceMix 3.0 User Guide space">use case</A>.</P>

<P>The <EM>File Binding</EM> example illustrates the following:</P>
<UL>
	<LI>an example of declarative programming</LI>
	<LI>how to interact with the file system</LI>
	<LI>how to use a WorkManager thread pool</LI>
</UL>


<P>The XML code for the <EM>File Binding</EM> example is located in the ServiceMix installation directory under the <TT>examples\file-binding</TT> directory in the <TT>servicemix.xml</TT> file. It is recommended that you refer to the <TT>servicemix.xml</TT> file while reading this document.</P>

<P>The <EM>File Binding</EM> XML file, <TT>servicemix.xml</TT>, contains two components and a supporting bean. One component waits for a file to be deposited into the the <TT>inbox</TT>directory, retrieves it, creates a normalized message that contains the file, then sends the message to the Normalized Message Router (NMR). The NMR routes the file to the other component, which deposits it into an <TT>outbox</TT> directory. Please be aware that for the out-of-the-box example the input and output files are not necessarily binary identical as their XML DOM is processed; so for instance comments will be lost. The bean provides a thread pool to enhance the performance of the reading and processing of the files. Details about the components and bean are discussed below.</P>
<TABLE cellpadding="5" width="85%" cellspacing="8px" class="infoMacro" border="0" align="center"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://goopen.org/confluence/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B class="strong">Note</B><BR>
<P>The file to be transmitted from the inbox to outbox must be in XML format.</P></TD></TR></TABLE>

<H3><A name="FileBinding-RunningtheFileBindingExample"></A>Running the <EM>File Binding</EM> Example</H3>

<P>From a command shell, go to the <EM>File Binding</EM> example directory:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">cd [SM30UG:servicemix_install_dir]\examples\file-binding</PRE>
</DIV></DIV>
<P>where <TT>servicemix_install_dir</TT> is the directory in which ServiceMix was installed.</P>

<P>Before running the example, copy a test file into the inbox directory:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">copy test-file.xml inbox</PRE>
</DIV></DIV>
<P>You need to download additional jars by running:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">ant setup</PRE>
</DIV></DIV>
<P>Then type:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">[SM30UG:servicemix_install_dir]\bin\servicemix servicemix.xml

OR

..\..\bin\servicemix servicemix.xml</PRE>
</DIV></DIV>
<P><BR clear="all">
After a few seconds, the <TT>sample_xxx.xml</TT> file will appear in the outbox directory. To see this open another command window and do a directory listing on the outbox directory, for example:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">dir [SM30UG:servicemix_install_dir]\examples\file-binding\outbox</PRE>
</DIV></DIV>
<P>If you would like to see more files moved from <TT>inbox</TT> to <TT>outbox</TT>, copy another file into the <TT>inbox</TT> directory. The <EM>file binding</EM> program continually polls (every 1000 ms) for new files, so any new file placed in <TT>inbox</TT>, will be transmitted to <TT>outbox</TT>.
<BR clear="all"></P>
<TABLE cellpadding="5" width="85%" cellspacing="8px" class="tipMacro" border="0" align="center"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://goopen.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B class="strong">Handy Hint</B><BR>
<P>Add <EM>$SERVICEMIX_HOME/bin</EM> directory to <EM>$PATH</EM> variable to simplify execution of the example.</P></TD></TR></TABLE>

<H2><A name="FileBinding-StoppingtheFileBindingExample"></A>Stopping the <EM>File Binding</EM> Example</H2>

<P>To terminate the <EM>File Binding</EM> example type &quot;CTRL-C&quot; in the command shell in which it is running and answer &quot;y&quot; to the &quot;Terminate batch job (y/n)?&quot; question.
<BR clear="all"></P>

<H2><A name="FileBinding-HowitWorks"></A>How it Works</H2>

<P>The diagram below illustrates the logical flow of the program through the <EM>file binding</EM> components.</P>

<P><BR clear="all">
<BR clear="all"></P>
<DIV class="panel" style="border-style: solid; border-color: #ccc; "><DIV class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><B>File Binding Logical Flow Diagram</B></DIV><DIV class="panelContent">
<P><DIV align="center"><IMG src="file-binding.data/filebindingexample.jpg" border="0"></DIV></P>
</DIV></DIV>
<P><BR clear="all">
<BR clear="all"></P>

<P>The logical flow of the program is:</P>
<OL>
	<LI>The <EM>filePoller</EM> polls the <TT>inbox</TT> directory every 1000 ms looking for a file.</LI>
	<LI>Once a file appears in the <TT>inbox</TT> directory, the <EM>filePoller</EM> gets a thread from the <EM>workManager</EM>. The thread will be used to process the file.</LI>
	<LI>The <EM>filePoller</EM>creates a normalized message that contains the file to be transmitted. It sends the normalized message to the NMR. The NMR routes the message to the <EM>fileSender</EM> component.</LI>
	<LI>The <EM>fileSender</EM> transforms the normalized message back into a file and &quot;sends&quot; it (places it) to the <TT>outbox</TT> directory.</LI>
</OL>


<P>Logging information is written to the console as files are transmitted. Typical output looks like the following:
<BR clear="all"></P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java">Starting Apache ServiceMix ESB: 3.0-incubating

Loading Apache ServiceMix from file: servicemix.xml
INFO  - JBIContainer                   - ServiceMix 3.0-incubating JBI Container (ServiceMix) is starting
INFO  - JBIContainer                   - For help or more informations please see: http:<SPAN class="code-comment">//incubator.apache.org/servicemix/
</SPAN>INFO  - ConnectorServerFactoryBean     - JMX connector available at: service:jmx:rmi:<SPAN class="code-comment">///jndi/rmi://localhost:1099/jmxrmi
</SPAN>INFO  - ComponentMBeanImpl             - Initializing component: #SubscriptionManager#
INFO  - DeploymentService              - Restoring service assemblies
INFO  - ComponentMBeanImpl             - Initializing component: fileSender
INFO  - ComponentMBeanImpl             - Initializing component: filePoller
INFO  - JBIContainer                   - ServiceMix JBI Container (ServiceMix) started</PRE>
</DIV></DIV>

<H2><A name="FileBinding-Details"></A>Details</H2>

<P>The following table provides more details about the function of each component and bean in the <TT>servicemix.xml</TT> file.
<BR clear="all">
<BR clear="all"></P>
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Component or Bean ID </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> <EM>filePoller</EM> </TD>
<TD class="confluenceTd"> This component periodically checks the &quot;inbox&quot; directory looking for files. If there is a file or directory present, it adds the file to the &quot;workingSet&quot;, which is a collection of files to be processed. The <EM>workManger</EM> is invoked to schedule the work of processing the file from the workingSet. Another thread is created and the processing of the file begins. Processing consists of marshalling the file (streaming it from disk into a normalized message). The normalized message is sent over the NMR to the <EM>fileSender</EM> component per the specified &quot;destinationService&quot;. The destinationService is specified in the <TT>servicemix.xml</TT> file as an attribute the <EM>filePoller</EM> component. In this example, the &quot;destinationService&quot; is the <EM>fileSender</EM> component. Finally, after it has been processed, the <EM>filePoller</EM> deletes the file from the source directory. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>fileSender</EM> </TD>
<TD class="confluenceTd"> This component is the &quot;destinationService&quot; for the <EM>filePoller</EM>. It receives normalized messages from <EM>filePoller</EM>. The messages it receives are the files that <EM>filePoller</EM>has transferred to it via the NMR. It converts the normalized message to its original file format and sends it to the destination directory, the <TT>outbox</TT> directory. This component creates the filename to which to copy the file by concatenating the string &quot;sample_&quot; with the process id following by &quot;.xml&quot;. The concatenated string is passed to the org.servicemix.expression.JaxenStringXPathExpression bean as an argument to the constructor, as can be seen by the <TT>constructor-arg value</TT> tag in the XML file. </TD>
</TR>
<TR>
<TD class="confluenceTd"> <EM>workManager</EM> </TD>
<TD class="confluenceTd"> This bean is used by the <EM>filePoller</EM> to increase the throughput of the application. The workManager is a thread pool whose size can be adjusted declaratively in the <TT>servicemix.xml</TT> file. The other components in the <EM>File Binding</EM> application ask the <EM>workManager</EM> for threads as needed. For example, threads are used by this application to periodically (every second) check for files in the <TT>inbox</TT>. Other threads are used to do the work of processing files (streaming them in, normalizing them, and sending them to the NMR). <EM>Note:</EM> The <EM>fileSender</EM> component also uses a thread to do its&apos; work, however, it is not using a thread from the <EM>workManager&apos;s</EM> thread pool. </TD>
</TR>
</TBODY></TABLE>

<H2><A name="FileBinding-UsefulCodeHints"></A>Useful Code Hints</H2>

<P>This section describes the start-up sequence and how the ServiceMix container interacts with the <EM>File Binding</EM>application. The Java class files are located in the servicemix-1.0.1.jar file in the ServiceMix installation directory. To look at the Java source code, unjar and decompile the .class files or <SPAN class="nobr"><A href="http://www.servicemix.org/Downloads" title="Visit page outside Confluence" rel="nofollow">download<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> the source code. Please note: the downloadable source code is slightly different than the compiled binary code.</P>

<P>Viewing the Java source code is recommended for understanding the information in this section.</P>

<P><B><EM>filePoller</EM></B> <B>Details</B></P>
<OL>
	<LI>The ServiceMix container reads the <TT>servicemix.xml</TT> file and sees it needs to instantiate a <B>FilePoller</B>.</LI>
	<LI>The container calls the init() method of <B>FilePoller</B>, as well as the init() methods of its parents.</LI>
	<LI>The container determines that <B>FilePoller</B> is an MBean and, therefore, calls the start() method of <B>FilePoller</B>, which it inherits from its parent PollingComponentSupport.</LI>
	<LI>The start() method will: (<B>See:</B> PollingComponentSupport.java code fragment below)<BR>
A. Create a timerTask.<BR>
B. Schedule the timerTask at a fixed rate. The start() method uses the &quot;timer&quot; (created in the init method) to schedule the timerTask at a fixed rate: timer.scheduleAtFixedRate(timerTask, firstTime, period). Recall &quot;period&quot; is a property of <B>FilePoller</B>. It was assigned the value of 1000ms by dependency injection from the <TT>servicemix.xml</TT> file.<BR>
C. timer will call the run() method of the timerTask periodically. timerTask&apos;s run method() is defined inline. This run() method will get the <B>workManager</B> object (see below for details).<BR>
D. The <B>workManager</B> will call &quot;scheduleWork(PollingComponentSupport.this)&quot;. &#95;Note:_it passes in PollingComponent support, which by virtue of its inheritance hierarchy, is of type &quot;Work&quot;, which is a &quot;Runnable&quot; object.<BR>
E. &quot;workManager.scheduleWork(Work)&quot; will get a Thread, passing in a Runnable object, i.e. PollingComponentSupport, and call its run() method.<BR>
F. PollingComponent&apos;s run() method calls poll(), which is implemented in <B>FilePoller</B>.<BR>
G. From this point on the call sequence can be followed in <B>FilePoller</B>...<BR>
H. The start() method of PollingComponentSupport, will eventually call super.start(), which propagates up to call the start() method of BaseLifeCycle, which sets the component state to &quot;RUNNING.&quot;</LI>
</OL>


<P>Eventually, one of the threads that is polling (see step G) for a file in the <TT>inbox</TT> directory will see a one. It will use <B>workManager&apos;s</B> thread pool to get a thread for processing the file. Processing the file consists of streaming it from <TT>inbox</TT>, creating a normalized message, and sending the message to the NMR.</P>
<DIV class="code" style="border-style: solid; "><DIV class="codeHeader" style="border-bottom-style: solid; "><B>PollingComponentSupport.java</B></DIV><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">protected</SPAN> void init() <SPAN class="code-keyword">throws</SPAN> JBIException {
        <SPAN class="code-keyword">if</SPAN> (scheduler == <SPAN class="code-keyword">null</SPAN>) {
            scheduler = <SPAN class="code-keyword">new</SPAN> Scheduler(<SPAN class="code-keyword">true</SPAN>);
        }
        <SPAN class="code-keyword">if</SPAN> (scheduleIterator == <SPAN class="code-keyword">null</SPAN>) {
        	scheduleIterator = <SPAN class="code-keyword">new</SPAN> PollScheduleIterator();
        }
        <SPAN class="code-keyword">if</SPAN> (workManager == <SPAN class="code-keyword">null</SPAN>) {
            ComponentContextImpl context = (ComponentContextImpl) getContext();
            workManager = context.getWorkManager();
        }
        <SPAN class="code-keyword">super</SPAN>.init();

    }</PRE>
</DIV></DIV>
<P><B><EM>workManager</EM></B> <B>Details</B></P>

<P><EM>workManager</EM> is a property of the <B>FilePoller</B> object. This property is defined by a local reference, the &quot;ref&quot; attribute in the <TT>servicemix.xml</TT> file. The local reference is a bean which instantiates org.activemq.work.SpringWorkManager.</P>

<P>The SpringWorkManager is a Spring bean. By default when a Spring bean starts, the properties are set, and then the afterPropertiesSet() method is called by the container.</P>

<P>The <B>workManager</B> is used to allocate threads. The <B>FilePoller</B> asks for threads from the <B>workManager</B> for two operations:</P>
<OL>
	<LI>The timerTask uses threads from the thread pool to periodically check the <TT>inbox</TT> directory for files.</LI>
	<LI>The <B>workManager</B> will also allocate a thread to process a file (read, normalize and send to NMR). The <B>workManager</B> calls a scheduleWork() method which is non-blocking. Therefore, if multiple files need to be processed, <B>FilePoller</B> can continue making requests to the <B>workManager</B> to schedule work.</LI>
</OL>


<P>Summarizing, when the ServiceMix container instantiates an MBean it firsts sets the property values if there are any, then calls the init() method of the class and its&apos; parent classes, if applicable. Then it calls the start() method of the class. When a Spring bean starts up, the properties are set and then the afterPropertiesSet() method is called.</P>

<H2><A name="FileBinding-Usecase"></A>Use case</H2>

<P>The <EM>file binding</EM> example shows how components of ServiceMix can interact with the file system. This is important because there are applications that write files out to a directory on disk and other applications that may need access to those files. This is a simple example of how a ServiceMix component can read a file from the disk, process it into a normalized message, then send it via the NMR to another ServiceMix component. The receiving component can process the message (which contains the file) and write it out to another location on disk.</P>

<P>A hypothetical business scenario: An online wholesale distributor of books and music CDs, receives a nightly order from a retail store. The nightly order is transmitted to the distributor as a file and placed in a particular directory on disk. There is a ServiceMix component (getOrders) that continually scans that directory looking for order files. When it sees a file, it reads it from the disk, then transforms it into a normalized message. It sends the message over the bus (NMR) to another component called &quot;placeOrders.&quot; The  placeOrders program divides the order into separate orders for its&apos; suppliers, e.g., one order will be placed with the distributor&apos;s book supplier, one order will go to the CD supplier, etc. At some later point, the suppliers will log in and retrieve their order files - this is not shown here, but can have an automatic or manual implementation and this process could also be integrated with ServiceMix.</P>

<P>The following diagram illustrates this:</P>
<DIV class="panel" style="border-style: solid; border-color: #ccc; "><DIV class="panelHeader" style="border-bottom-style: solid; border-bottom-color: #ccc; "><B>Online Distributor&apos;s Order Processing System</B></DIV><DIV class="panelContent">
<P><DIV align="center"><IMG src="file-binding.data/filebinding_as_usecase.jpg" border="0"></DIV></P>
</DIV></DIV>

<H2><A name="FileBinding-RelatedDocumentation"></A>Related Documentation</H2>

<P>For more information on the following topics please see:</P>
<UL>
	<LI><SPAN class="nobr"><A href="http://goopen.org/confluence/pages/createpage.action?spaceKey=SM30UG&title=Glossary" title="Create Page in space SM30UG: Glossary" class="createlink">NMR<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/plus.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<UL>
	<LI><SPAN class="nobr"><A href="http://www.servicemix.org/Spring%20support" title="Visit page outside Confluence" rel="nofollow">Spring<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<P><BR clear="all">
For a brief explanation of the XML tags in the <TT>servicemix.xml</TT> file, please see:</P>
<UL>
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/servicemix/xml-schemas.html" title="Visit page outside Confluence" rel="nofollow">XSD<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="cluster.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="cluster.html">Cluster</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-examples.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-examples.html">4. Examples</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="loan-broker.html">Loan Broker</A></TD><TD class="ScrollbarNextIcon"><A href="loan-broker.html"><IMG border="0" align="middle" src="http://goopen.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV></DIV>
          
                  </DIV>
        </TD>
      </TR>
      </TABLE>     
      </DIV>
    </DIV>
    <DIV id="site-footer">
          Added by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnodet">Guillaume Nodet</A>,
    last edited by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnodet">Guillaume Nodet</A> on Nov 08, 2006
                  &nbsp;(<A href="http://goopen.org/confluence/pages/diffpages.action?pageId=13494&originalId=14669">view change</A>)
                      <SPAN id="show" class="inline-control-link"><A href="" onclick="showComment(); return false;">show comment</A></SPAN>
        <SPAN id="hide" class="inline-control-link" style="display:none;"><A href="" onclick="hideComment(); return false;">hide comment</A></SPAN>
          <DIV id="versionComment" class="noteMacro" style="display:none; padding: 5px;">
      <B>Comment:</B>
      INS: no binary copy, but processed<BR>
      <SPAN class="smalltext"><A href="http://goopen.org/confluence/pages/viewpreviouspageversions.action?pageId=13494">View page history</A></SPAN>
  </DIV>

    <SCRIPT>
      var show = document.getElementById('show');
      var hide = document.getElementById('hide');
      var versionComment = document.getElementById('versionComment');

      function showComment(){
        show.style.display = 'none';
        hide.style.display = 'inline';
        versionComment.style.display = 'block';
      }

      function hideComment(){
        show.style.display = 'inline';
        hide.style.display = 'none';
        versionComment.style.display = 'none';
      }

    </SCRIPT>
    
      (<A href="http://goopen.org/confluence/pages/editpage.action?pageId=13494">edit page</A>)
    </DIV>

  </BODY>

</HTML>