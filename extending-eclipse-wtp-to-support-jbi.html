
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <LINK type="text/css" rel="stylesheet" href="resources/space.css">
    <SCRIPT src="resources/space.js" type="text/javascript"></SCRIPT>
    <TITLE>
Extending Eclipse WTP to support JBI
    </TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">

    <!-- Banner -->
    <DIV id="site-banner">

      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" class="topbardiv" nowrap="">
            <IMG border="0" src="http://www.logicblaze.com/images/logos/products/ServiceMix/ServiceMix_logo_150.jpg">
          </TD>
          <TD align="right" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/images/apache-incubator-logo.png">
          </TD>
        </TR> 
      </TABLE>

    </DIV>

    <!-- Bread crumbs and Quick Links -->
    <DIV id="site-navbar">
      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" valign="middle" nowrap="">
            <DIV id="site-breadcrumbs">
<A href="home.html" title="ServiceMix">ServiceMix</A>&nbsp;&gt;&nbsp;<A href="home.html" title="Home">Home</A>&nbsp;&gt;&nbsp;<A href="documentation.html" title="Documentation">Documentation</A>&nbsp;&gt;&nbsp;<A href="architecture.html" title="Architecture">Architecture</A>&nbsp;&gt;&nbsp;<A href="" title="Extending Eclipse WTP to support JBI">Extending Eclipse WTP to support JBI</A>
            </DIV>
          </TD>
          <TD align="right" valign="middle" nowrap="">
            <DIV id="site-quicklinks">
<P><A href="download.html" title="Download">Download</A> &#124; <SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> <SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" title="Visit page outside Confluence" rel="nofollow">Components<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <A href="source.html" title="Source">Source</A> &#124; <SPAN class="nobr"><A href="home.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124;<SPAN class="nobr"><A href="irc://irc.codehaus.org/servicemix" title="Visit page outside Confluence" rel="nofollow">IRC<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <SPAN class="nobr"><A href="http://servlet.uwyn.com/drone/log/hausbot/servicemix" title="Visit page outside Confluence" rel="nofollow">IRC Log<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124; <A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A> &#124; <A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A> &#124; <A href="support.html" title="Support">Support</A></P>
            </DIV>
          </TD>
        </TR> 
      </TABLE>
    </DIV>

<!-- Integrate google search later.
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF- 8" />
            <input type="hidden" name="oe" value="UTF- 8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
-->

      <DIV id="site-content">
        <TABLE>
        <TR>
        <TD valign="top">
          <DIV id="site-navigation">
<H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="home.html" title="Home">Home</A></LI>
	<LI><A href="introduction-to-esb.html" title="Introduction to ESB">Introduction to ESB</A></LI>
	<LI><A href="background-to-servicemix.html" title="Background to ServiceMix">Background to ServiceMix</A></LI>
	<LI><A href="news.html" title="News">News</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="site.html" title="Site">Site</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="navigation.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">Contributing</A></LI>
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="users.html" title="Users">Users</A></LI>
</UL>


<H3><A name="Navigation-Documentation"></A>Documentation</H3>

<UL class="alternate" type="square">
	<LI><A href="getting-started.html" title="Getting Started">Getting Started</A></LI>
	<LI><A href="running.html" title="Running">Running</A></LI>
	<LI><A href="examples.html" title="Examples">Examples</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="use-cases-whole.html" title="Use Cases (whole)">Use Cases &#40;whole&#41;</A></LI>
	<LI><A href="configuration.html" title="Configuration">Configuration</A></LI>
	<LI><A href="xml-reference.html" title="Xml Reference">Xml Reference</A></LI>
	<LI><A href="management.html" title="Management">Management</A></LI>
	<LI><A href="architecture.html" title="Architecture">Architecture</A></LI>
	<LI><A href="clustering.html" title="Clustering">Clustering</A></LI>
	<LI><A href="nmr-flows.html" title="NMR Flows">NMR Flows</A></LI>
	<LI><A href="articles.html" title="Articles">Articles</A></LI>
</UL>


<H3><A name="Navigation-Reference"></A>Reference</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://java.sun.com/integration/1.0/docs/sdk/api/index.html" title="Visit page outside Confluence" rel="nofollow">JBI API<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Core<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-components/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Components<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix-console/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Console<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="glossary.html" title="Glossary">Glossary</A></LI>
</UL>


<H3><A name="Navigation-Features"></A>Features</H3>

<UL class="alternate" type="square">
	<LI><A href="components.html" title="Components">Components</A></LI>
	<LI><A href="routing.html" title="Routing">Routing</A></LI>
	<LI><A href="transformation.html" title="Transformation">Transformation</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="spring-client-toolkit.html" title="Spring Client Toolkit">Spring Client Toolkit</A></LI>
	<LI><A href="client-api.html" title="Client API">Client API</A></LI>
	<LI><A href="beanflow.html" title="BeanFlow">BeanFlow</A></LI>
	<LI><A href="pojo-support.html" title="POJO support">POJO support</A></LI>
	<LI><A href="expressions.html" title="Expressions">Expressions</A></LI>
	<LI><A href="component-helper-classes.html" title="Component helper classes">Component helper classes</A></LI>
	<LI><A href="ant-tasks.html" title="Ant Tasks">Ant Tasks</A></LI>
	<LI><A href="jmx-console.html" title="JMX Console">JMX Console</A></LI>
</UL>


<H3><A name="Navigation-Integration"></A>Integration</H3>

<UL class="alternate" type="square">
	<LI><A href="spring-support.html" title="Spring support">Spring support</A></LI>
	<LI><A href="geronimo-integration.html" title="Geronimo Integration">Geronimo Integration</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Integration</A></LI>
	<LI><A href="tomcat-integration.html" title="Tomcat Integration">Tomcat Integration</A></LI>
	<LI><A href="jonas-integration.html" title="JOnAS Integration">JOnAS Integration</A></LI>
	<LI><A href="jndi-configuration.html" title="JNDI configuration">JNDI configuration</A></LI>
</UL>


<H3><A name="Navigation-ServiceMixComponents"></A>ServiceMix Components</H3>

<UL class="alternate" type="square">
	<LI><A href="bpel.html" title="BPEL">BPEL</A></LI>
	<LI><A href="cache.html" title="Cache">Cache</A></LI>
	<LI><A href="drools.html" title="Drools">Drools</A></LI>
	<LI><A href="email.html" title="Email">Email</A></LI>
	<LI><A href="file.html" title="File">File</A></LI>
	<LI><A href="ftp.html" title="FTP">FTP</A></LI>
	<LI><A href="groovy.html" title="Groovy">Groovy</A></LI>
	<LI><A href="http.html" title="HTTP">HTTP</A></LI>
	<LI><A href="jabber.html" title="Jabber">Jabber</A></LI>
	<LI><A href="jax-ws.html" title="JAX WS">JAX WS</A></LI>
	<LI><A href="jca.html" title="JCA">JCA</A></LI>
	<LI><A href="jms.html" title="JMS">JMS</A></LI>
	<LI><A href="quartz.html" title="Quartz">Quartz</A></LI>
	<LI><A href="reflection.html" title="Reflection">Reflection</A></LI>
	<LI><A href="rss.html" title="RSS">RSS</A></LI>
	<LI><A href="saaj.html" title="SAAJ">SAAJ</A></LI>
	<LI><A href="scripting.html" title="Scripting">Scripting</A></LI>
	<LI><A href="servicemix.html" title="ServiceMix">ServiceMix</A></LI>
	<LI><A href="validation.html" title="Validation">Validation</A></LI>
	<LI><A href="xfire.html" title="XFire">XFire</A></LI>
	<LI><A href="xpath-router.html" title="XPath Router">XPath Router</A></LI>
	<LI><A href="xslt.html" title="XSLT">XSLT</A></LI>
	<LI><A href="xsql.html" title="XSQL">XSQL</A></LI>
	<LI><A href="vfs.html" title="VFS">VFS</A></LI>
	<LI><A href="wsif.html" title="WSIF">WSIF</A></LI>
</UL>


<H3><A name="Navigation-Tooling"></A>Tooling</H3>

<UL class="alternate" type="square">
	<LI><A href="visualisation.html" title="Visualisation">Visualisation</A></LI>
	<LI><A href="eclipse-plugin.html" title="Eclipse plugin">Eclipse plugin</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Deployer</A></LI>
	<LI><A href="war-deployment.html" title="WAR Deployment">WAR Deployment</A></LI>
	<LI><A href="maven-jbi-plugin.html" title="Maven JBI plugin">Maven JBI plugin</A></LI>
	<LI><A href="maven-sar-plugin.html" title="Maven SAR plugin">Maven SAR plugin</A></LI>
</UL>


<H3><A name="Navigation-OtherJBIsoftware"></A>Other JBI software</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/projects/ode.html" title="Orchestration Engine" rel="nofollow">Apache ODE<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://activemq.codehaus.org/" title="High Performance Message Bus" rel="nofollow">Apache ActiveMQ<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://lingo.codehaus.org/" title="POJO Remoting using JMS" rel="nofollow">Lingo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://jencks.org/" title="Message Driven POJOs and pooling for JMS and JDBC" rel="nofollow">Jencks<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://stomp.codehaus.org/" title="Simple cross language protocol for messaging" rel="nofollow">Stomp<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.springframework.org/" title="Visit page outside Confluence" rel="nofollow">Spring<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://geronimo.apache.org/" title="Visit page outside Confluence" rel="nofollow">Geronimo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://forge.objectweb.org/projects/celtix/" title="Visit page outside Confluence" rel="nofollow">Celtix<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://xfire.codehaus.org/" title="Visit page outside Confluence" rel="nofollow">XFire<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Support"></A>Support</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM" title="Visit page outside Confluence" rel="nofollow">Issues<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:roadmap-panel" title="Visit page outside Confluence" rel="nofollow">Roadmap<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:changelog-panel" title="Visit page outside Confluence" rel="nofollow">Change log<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Developers"></A>Developers</H3>

<UL class="alternate" type="square">
	<LI><A href="source.html" title="Source">Source</A></LI>
	<LI><A href="roadmap.html" title="Roadmap">Roadmap</A></LI>
	<LI><A href="ideas.html" title="Ideas">Ideas</A></LI>
	<LI><A href="becoming-a-committer.html" title="Becoming a committer">Becoming a committer</A></LI>
	<LI><A href="release-guide.html" title="Release Guide">Release Guide</A></LI>
	<LI><SPAN class="nobr"><A href="http://ci.codehaus.org/beetlejuice/viewProjectSummary.action?projectName=ServiceMix" title="Visit page outside Confluence" rel="nofollow">BeetleJuice<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/clover/" title="Visit page outside Confluence" rel="nofollow">Clover Report<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/xref/index.html" title="Visit page outside Confluence" rel="nofollow">Source XRef<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/xref-test/index.html" title="Visit page outside Confluence" rel="nofollow">Test Source XRef<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.codehaus.org/maven/servicemix.xsd.html" title="Visit page outside Confluence" rel="nofollow">XSD<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Toolsweuse"></A>Tools we use</H3>

<P><SPAN class="nobr"><A href="http://www.yourkit.com/" title="Visit page outside Confluence" rel="nofollow"><IMG src="navigation.data/yourkit.jpg" align="absmiddle" border="0"><SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>
          </DIV>
        </TD>
        <TD valign="top">
          <DIV id="site-page">
          
            <DIV class="pagetitle">Extending Eclipse WTP to support JBI</DIV>
            <DIV class="wiki-content"><P>This document outlines the work that is underway to extend the Eclipse Web Tools Platform so that it can offer support for JBI components.&nbsp; In order to understand a little about the process we&apos;ll walk through the steps involved in added a new module type,&nbsp; creating a server definition and then ultimately adding the a new project type and deployables.</P>

<P>Its a work in progress,&nbsp; but hopefully by seeing the process of adding the extension we help feed innovation around WTP and JBI.</P>

<P>OK.. Lets start at the begining, we will basically create three plug-in projects,&nbsp; these will be for the server definition,&nbsp; the UI components of JBI and the JBI core components (which will cover creating deployables).</P>

<P>We will start in the UI project,&nbsp; and do our first big step,&nbsp; we will declare a new type of module.&nbsp; In our case this will be a jst.jbi.component (though obviously we could create a new module type for other things ie a BPEL module).</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.core.moduleTypes&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;moduleType id=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN> name=<SPAN class="code-quote">&quot;%jbi.component.module.type.name&quot;</SPAN> /&gt;</SPAN>
<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>A fine first move, and certainly one that we can be proud of.  Now we have our new module type we will want to build up all that wonderful functionality around it.</P>

<P>Now we have a module type we need to move on to the defining the ServiceMix server,  we aren&apos;t going to go into all the details here since it is more of a general overview of the functionality and steps required.  Server Definitions are basically just plug-in themselves,  though they need to implement some extension points to allow themselves to be added.  WTP supports the concept of a generic server,  this is one that is able to be started and controlled through a simple definition XML file and one that can handle publishing a project using an ANT task.  You can override this functionality and implement real Java classes to do it all though for our purposes we should be able to function using the Generic (though we do need to override the behaviour since generic servers look for an http connection to be in place to determine that the server has started).</P>

<P>To start lets look at our plugin.xml :</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.core.runtimeTypes&quot;</SPAN>&gt;</SPAN>
	   &lt;runtimeType
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN>
			name=<SPAN class="code-quote">&quot;%servicemix30.runtime.name&quot;</SPAN>
			description=<SPAN class="code-quote">&quot;%servicemix30.runtime.description&quot;</SPAN> vendor=<SPAN class="code-quote">&quot;%servicemix30.vendor&quot;</SPAN>
			version=<SPAN class="code-quote">&quot;3.0&quot;</SPAN>
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.core.internal.GenericServerRuntime&quot;</SPAN>&gt;
			<SPAN class="code-tag">&lt;moduleType types=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN> versions=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> /&gt;</SPAN>
		<SPAN class="code-tag">&lt;/runtimeType&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>First up we declare a runtime,  in WTP there is a separation between a runtime which contains the libraries and functionality that wish to associate to a project and a server which is a running instance of the runtime.  In this extension point we basically declare that we have a new runtime which is based on generic called servicemix30,  we also associate our modulue type with this runtime.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.core.serverTypes&quot;</SPAN>&gt;</SPAN>
		&lt;serverType
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.core.internal.GenericServer&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.servicemix30&quot;</SPAN>
			initialState=<SPAN class="code-quote">&quot;stopped&quot;</SPAN> supportsRemoteHosts=<SPAN class="code-quote">&quot;false&quot;</SPAN>
			runtimeTypeId=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN>
			description=<SPAN class="code-quote">&quot;%servicemix30.server.description&quot;</SPAN>
			launchConfigId=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.core.launchConfigurationType&quot;</SPAN>
			behaviourClass=<SPAN class="code-quote">&quot;org.eclipse.jst.server.servicemix.ServiceMixServerBehaviour&quot;</SPAN>
			name=<SPAN class="code-quote">&quot;%servicemix30.server.name&quot;</SPAN> startTimeout=<SPAN class="code-quote">&quot;75000&quot;</SPAN> stopTimeout=<SPAN class="code-quote">&quot;15000&quot;</SPAN>
			hasConfiguration=<SPAN class="code-quote">&quot;false&quot;</SPAN> launchModes=<SPAN class="code-quote">&quot;run,debug,profile&quot;</SPAN> runtime=<SPAN class="code-quote">&quot;true&quot;</SPAN>
			startBeforePublish=<SPAN class="code-quote">&quot;false&quot;</SPAN> /&gt;
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>Next up we need to declare our server type,  it sits on top of our runtime and determine some basic information as to how the server is started and stopped as well as whether it needs to be running to publish to.  Publish is where a project can be deployed (published) to a server,  note that publishing is always to a server not a runtime.</P>

<P>Next up since we are using the GenericServer class in our server type (see above) we need to declare where to get the definition for the server:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml">&lt;extension
		point=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.core.serverdefinition&quot;</SPAN>&gt;
		&lt;serverdefinition
			definitionfile=<SPAN class="code-quote">&quot;/servers/servicemix30.serverdef.xml&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN> /&gt;
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>The server definition is an interesting file (there is a good write-up on server definitions <SPAN class="nobr"><A href="http://blog.exadel.com/?p=17" title="Visit page outside Confluence" rel="nofollow">here<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>),  obviously our server definition will include the jst.jbi.component deploy and undeploy in the place of the EJB/WAR or EAR stuff that normally is used:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;?xml version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> encoding=<SPAN class="code-quote">&quot;UTF-8&quot;</SPAN>?&gt;</SPAN>
&lt;tns:ServerRuntime
	<SPAN class="code-keyword">xmlns:tns</SPAN>=<SPAN class="code-quote">&quot;http://eclipse.org/jst/server/generic/ServerTypeDefinition&quot;</SPAN>
	<SPAN class="code-keyword">xmlns:xsi</SPAN>=<SPAN class="code-quote">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</SPAN>
	xsi:schemaLocation=<SPAN class="code-quote">&quot;http://eclipse.org/jst/server/generic/ServerTypeDefinition&quot;</SPAN>
	name=<SPAN class="code-quote">&quot;Apache ServiceMix 3.0&quot;</SPAN> version=<SPAN class="code-quote">&quot;3.0&quot;</SPAN>&gt;

	&lt;property id=<SPAN class="code-quote">&quot;serverRootDirectory&quot;</SPAN>
		label=<SPAN class="code-quote">&quot;%servicemix30.installation.path&quot;</SPAN> type=<SPAN class="code-quote">&quot;directory&quot;</SPAN>
		context=<SPAN class="code-quote">&quot;runtime&quot;</SPAN> default=<SPAN class="code-quote">&quot;C:/servicemix-3.0&quot;</SPAN> /&gt;

	<SPAN class="code-tag">&lt;module&gt;</SPAN>
		<SPAN class="code-tag">&lt;type&gt;</SPAN>jst.jbi.component<SPAN class="code-tag">&lt;/type&gt;</SPAN>
		<SPAN class="code-tag">&lt;publishDir&gt;</SPAN>${serverRootDirectory}/install<SPAN class="code-tag">&lt;/publishDir&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherReference&gt;</SPAN>org.eclipse.jst.server.generic.antpublisher<SPAN class="code-tag">&lt;/publisherReference&gt;</SPAN>
	<SPAN class="code-tag">&lt;/module&gt;</SPAN>

	<SPAN class="code-tag">&lt;publisher id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.antpublisher&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>build.file<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>/buildfiles/servicemix30.xml<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>target.publish.jst.jbi.component<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>deploy.jbi.component<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>target.unpublish.jst.jbi.component<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>undeploy.jbi.component<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
	<SPAN class="code-tag">&lt;/publisher&gt;</SPAN>

	<SPAN class="code-tag">&lt;project&gt;</SPAN>
		<SPAN class="code-tag">&lt;classpathReference&gt;</SPAN>servicemix.project<SPAN class="code-tag">&lt;/classpathReference&gt;</SPAN>
	<SPAN class="code-tag">&lt;/project&gt;</SPAN>

	<SPAN class="code-tag">&lt;start&gt;</SPAN>
		<SPAN class="code-tag">&lt;mainClass&gt;</SPAN>org.codehaus.classworlds.Launcher<SPAN class="code-tag">&lt;/mainClass&gt;</SPAN>
		<SPAN class="code-tag">&lt;workingDirectory&gt;</SPAN>${serverRootDirectory}<SPAN class="code-tag">&lt;/workingDirectory&gt;</SPAN>
		<SPAN class="code-tag">&lt;programArguments&gt;</SPAN><SPAN class="code-tag">&lt;/programArguments&gt;</SPAN>
		<SPAN class="code-tag">&lt;vmParameters&gt;</SPAN>
			-Xms128m
			-Dclassworlds.conf=${serverRootDirectory}\conf\servicemix.conf
			-Xmx512m
			-Djava.endorsed.dirs=${serverRootDirectory}\lib\endorsed
			-Dservicemix.home=${serverRootDirectory}
		<SPAN class="code-tag">&lt;/vmParameters&gt;</SPAN>
		<SPAN class="code-tag">&lt;classpathReference&gt;</SPAN>servicemix<SPAN class="code-tag">&lt;/classpathReference&gt;</SPAN>
	<SPAN class="code-tag">&lt;/start&gt;</SPAN>

	<SPAN class="code-tag">&lt;stop&gt;</SPAN>
		<SPAN class="code-tag">&lt;mainClass&gt;</SPAN>org.probably.should.do.this<SPAN class="code-tag">&lt;/mainClass&gt;</SPAN>
		<SPAN class="code-tag">&lt;workingDirectory&gt;</SPAN>${serverRootDirectory}/bin<SPAN class="code-tag">&lt;/workingDirectory&gt;</SPAN>
		<SPAN class="code-tag">&lt;vmParameters&gt;</SPAN><SPAN class="code-tag">&lt;/vmParameters&gt;</SPAN>
		<SPAN class="code-tag">&lt;classpathReference&gt;</SPAN>servicemix<SPAN class="code-tag">&lt;/classpathReference&gt;</SPAN>
	<SPAN class="code-tag">&lt;/stop&gt;</SPAN>

	<SPAN class="code-tag">&lt;publisher id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.antpublisher&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>build.file<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>/buildfiles/servicemix30.xml<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>target.publish.jbi<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>deploy.jbi.component<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
		<SPAN class="code-tag">&lt;publisherdata&gt;</SPAN>
			<SPAN class="code-tag">&lt;dataname&gt;</SPAN>target.unpublish.jbi<SPAN class="code-tag">&lt;/dataname&gt;</SPAN>
			<SPAN class="code-tag">&lt;datavalue&gt;</SPAN>undeploy.jbi.component<SPAN class="code-tag">&lt;/datavalue&gt;</SPAN>
		<SPAN class="code-tag">&lt;/publisherdata&gt;</SPAN>
	<SPAN class="code-tag">&lt;/publisher&gt;</SPAN>

	<SPAN class="code-tag">&lt;classpath id=<SPAN class="code-quote">&quot;servicemix&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;archive path=<SPAN class="code-quote">&quot;${serverRootDirectory}/conf&quot;</SPAN> /&gt;</SPAN>
		&lt;archive
			path=<SPAN class="code-quote">&quot;${serverRootDirectory}/lib/classworlds-1.0.1.jar&quot;</SPAN> /&gt;
	<SPAN class="code-tag">&lt;/classpath&gt;</SPAN>

	<SPAN class="code-tag">&lt;classpath id=<SPAN class="code-quote">&quot;servicemix.project&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;archive path=<SPAN class="code-quote">&quot;${serverRootDirectory}/servicemix-3.0-M1.jar&quot;</SPAN> /&gt;</SPAN>
	<SPAN class="code-tag">&lt;/classpath&gt;</SPAN>
<SPAN class="code-tag">&lt;/tns:ServerRuntime&gt;</SPAN></PRE>
</DIV></DIV>
<P>Note that we use classworlds to get the server started, and yes we really ought to get the shutdown finished <IMG class="emoticon" src="http://goopen.org/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"></P>

<P>Also note that we have used the ANT publisher in the definition of our servers,  this means that the files buildfiles/servicemix30.xml will be used as the ANT project and when you choose to publish a JBI component or unpublish one the targets deploy.jbi.component and undeploy.jbi.component are used respectively.  Note that in the server definition we also define classpath&apos;s for the server to use to start/stop and also for a project that will use this server definition to act as its runtime.  This means we can get the classpath from the server when we are creating a project against it as a runtime,  to make the project classpath available we need to add this extension point:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.jst.server.core.runtimeClasspathProviders&quot;</SPAN>&gt;</SPAN>
    	&lt;runtimeClasspathProvider
	        id=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN>
	        runtimeTypeIds=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN>
	        class=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.core.internal.GenericServerRuntimeTargetHandler&quot;</SPAN>/&gt;
    <SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>So now thanks to the magic of WTP we have defined a module and a generic server to deal with it.  Since we are proud of our creation so far we can use an extension point to give our runtime and server a nice icon.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.ui.serverImages&quot;</SPAN>&gt;</SPAN>
		&lt;image icon=<SPAN class="code-quote">&quot;/icons/servicemix.gif&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.apache.servicemix.server.image&quot;</SPAN>
			typeIds=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.servicemix30&quot;</SPAN> /&gt;
		&lt;image icon=<SPAN class="code-quote">&quot;/icons/servicemix.gif&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.apache.servicemix.server.image&quot;</SPAN>
			typeIds=<SPAN class="code-quote">&quot;org.eclipse.jst.server.generic.runtime.servicemix30&quot;</SPAN> /&gt;
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>OK.. so far we have added a new type of module (in this case JBI) and defined a server that is capable of handling it.</P>

<P>We could start up Eclipse with our plugins in place and <SPAN class="nobr"><A href="extending-eclipse-wtp-to-support-jbi.data/exampleServer.swf" title="exampleServer.swf attached to Extending Eclipse WTP to support JBI">we should start seeing some results<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>&#33;  Note that the runtime settings are being requested by the server definition (ie. the location of our ServiceMix installation).</P>

<P>However,  what we now what is to be able to create a project which can interact with both our server and runtime definitions.  This means be able to reference the runtime when creating the project and also leverage the WTP publish/deploy architecture so that we can publish our project to a runtime.&nbsp; In order to do this we need to create a new type of <B>Facet</B>, facet&apos;s are basically a way to introduce functionality to projects in Eclipse, therefore a project can have one or more facets (ie. it could be a Java project and a EJB project).</P>

<P>Lets look at the project facet definition from our core JBI plugin.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml">&lt;extension
		point=<SPAN class="code-quote">&quot;org.eclipse.wst.common.project.facet.core.facets&quot;</SPAN>&gt;
		<SPAN class="code-tag">&lt;project-facet id=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>&gt;</SPAN>
			<SPAN class="code-tag">&lt;label&gt;</SPAN>%jbi.component.facet.label<SPAN class="code-tag">&lt;/label&gt;</SPAN>
			<SPAN class="code-tag">&lt;description&gt;</SPAN>
				%jbi.component.facet.description
			<SPAN class="code-tag">&lt;/description&gt;</SPAN>
			<SPAN class="code-tag">&lt;icon&gt;</SPAN>icons/jbi-component.gif<SPAN class="code-tag">&lt;/icon&gt;</SPAN>
		<SPAN class="code-tag">&lt;/project-facet&gt;</SPAN>
		&lt;project-facet-version facet=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>
			version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>&gt;
			<SPAN class="code-tag">&lt;constraint&gt;</SPAN>
	        <SPAN class="code-tag">&lt;and&gt;</SPAN>
	          <SPAN class="code-tag">&lt;requires facet=<SPAN class="code-quote">&quot;jst.java&quot;</SPAN> version=<SPAN class="code-quote">&quot;[1.4&quot;</SPAN>/&gt;</SPAN>
	        <SPAN class="code-tag">&lt;/and&gt;</SPAN>
	        <SPAN class="code-tag">&lt;conflicts group=<SPAN class="code-quote">&quot;modules&quot;</SPAN>/&gt;</SPAN>
	      <SPAN class="code-tag">&lt;/constraint&gt;</SPAN>
	      <SPAN class="code-tag">&lt;group-member id=<SPAN class="code-quote">&quot;modules&quot;</SPAN>/&gt;</SPAN>
		<SPAN class="code-tag">&lt;/project-facet-version&gt;</SPAN>
		<SPAN class="code-tag">&lt;action facet=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN> version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> type=<SPAN class="code-quote">&quot;install&quot;</SPAN>&gt;</SPAN>
			&lt;delegate
					class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui.project.facet.JbiFacetInstallDelegate&quot;</SPAN> /&gt;
			&lt;config-factory
					class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.internal.project.operations.JbiFacetInstallDataModelProvider&quot;</SPAN> /&gt;
		<SPAN class="code-tag">&lt;/action&gt;</SPAN>
		<SPAN class="code-tag">&lt;template id=<SPAN class="code-quote">&quot;template.jst.jbi.component&quot;</SPAN>&gt;</SPAN>
			<SPAN class="code-tag">&lt;label&gt;</SPAN>%jbi.component.facet.label<SPAN class="code-tag">&lt;/label&gt;</SPAN>
			<SPAN class="code-tag">&lt;fixed facet=<SPAN class="code-quote">&quot;jst.java&quot;</SPAN>/&gt;</SPAN>
	      	<SPAN class="code-tag">&lt;fixed facet=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>/&gt;</SPAN>
		<SPAN class="code-tag">&lt;/template&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>As we can see we basically introduce a facet called jst.jbi.component.  In the definition we can give a little information about the type of requirements this facet would have,  in this case we need a version of the Java facet equal to or greater than 1.4 (since JBI has that requirement).  Also important is the concept of building delegates and config factories in order to allow the facet to have information gathered that it needs in a model (represented in the config-factory) and a delegate that is responsible for installing any requirements into the project for this facet.</P>

<P>Also note that we provide a template,  this can be used in the wizard to show the default facets, in our case we wanted only that the java facet be there.</P>

<P>Before diving into the Java code for these classes there are two more extension point that we want to add first:</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.ui.newWizards&quot;</SPAN>&gt;</SPAN>
		&lt;category name=<SPAN class="code-quote">&quot;%jbi.category&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui&quot;</SPAN>&gt;
		<SPAN class="code-tag">&lt;/category&gt;</SPAN>
		&lt;wizard name=<SPAN class="code-quote">&quot;%jbi.component.project.name&quot;</SPAN> icon=<SPAN class="code-quote">&quot;/icons/jbi-component.gif&quot;</SPAN>
			category=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui&quot;</SPAN>
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui.project.facet.JbiProjectWizard&quot;</SPAN>
			project=<SPAN class="code-quote">&quot;true&quot;</SPAN>
			finalPerspective=<SPAN class="code-quote">&quot;org.eclipse.jdt.internal.ui.JavaHierarchyPerspectiveFactory&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui.project.facet.JbiProjectWizard&quot;</SPAN>&gt;
			<SPAN class="code-tag">&lt;description&gt;</SPAN>%jbi.component.project.description<SPAN class="code-tag">&lt;/description&gt;</SPAN>
		<SPAN class="code-tag">&lt;/wizard&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN>

	<SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.common.project.facet.ui.wizard&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;wizard-pages facet=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN> version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>&gt;</SPAN>
			<SPAN class="code-tag">&lt;install&gt;</SPAN>
				&lt;page
					class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.ui.project.facet.JbiFacetInstallPage&quot;</SPAN> /&gt;
			<SPAN class="code-tag">&lt;/install&gt;</SPAN>
		<SPAN class="code-tag">&lt;/wizard-pages&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>These are used to first define our new JBI project wizard and then to define the install page for our JBI facet,  since we are leveraging the WST/JST we will be able to re-use much of their infrastructure to get us a little closer.</P>

<P>OK... lets get started with the new project wizard,  we can re-use much of the JEE stuff that those busy people on WTP have done (thanks&#33;&#33;).  For our new project wizard we can extend NewProjectDataModelFacetWizard.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class JbiProjectWizard <SPAN class="code-keyword">extends</SPAN> NewProjectDataModelFacetWizard {

	<SPAN class="code-keyword">public</SPAN> JbiProjectWizard(IDataModel model) {
		<SPAN class="code-keyword">super</SPAN>(model);
		setWindowTitle(JBIUIMessages.KEY_1);
	}

	<SPAN class="code-keyword">public</SPAN> JbiProjectWizard() {
		<SPAN class="code-keyword">super</SPAN>();
		setWindowTitle(JBIUIMessages.KEY_1);
	}

	<SPAN class="code-keyword">protected</SPAN> IDataModel createDataModel() {
		<SPAN class="code-keyword">return</SPAN> DataModelFactory
				.createDataModel(<SPAN class="code-keyword">new</SPAN> JbiFacetProjectCreationDataModelProvider());
	}

	<SPAN class="code-keyword">protected</SPAN> IFacetedProjectTemplate getTemplate() {
		<SPAN class="code-keyword">return</SPAN> ProjectFacetsManager.getTemplate(<SPAN class="code-quote">&quot;template.jst.jbi.component&quot;</SPAN>); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>	}

	<SPAN class="code-keyword">protected</SPAN> IWizardPage createFirstPage() {
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">new</SPAN> JbiProjectFirstPage(model, <SPAN class="code-quote">&quot;first.page&quot;</SPAN>); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>	}

	<SPAN class="code-keyword">protected</SPAN> ImageDescriptor getDefaultPageImageDescriptor() {
		<SPAN class="code-keyword">final</SPAN> Bundle bundle = Platform.getBundle(Activator.PLUGIN_ID); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>		<SPAN class="code-keyword">final</SPAN> URL url = bundle.getEntry(<SPAN class="code-quote">&quot;icons/jbi-component.gif&quot;</SPAN>); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>		<SPAN class="code-keyword">return</SPAN> ImageDescriptor.createFromURL(url);
	}

}</PRE>
</DIV></DIV>
<P>In the example new project wixard we see the use of an IDataModel,  basically this is a holder for the parameters that we want to gather during the set-up of the project.  Our implementation re-uses much of the WTP facet stuff by extending FacetProjectCreationDataModelProvider.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class JbiFacetProjectCreationDataModelProvider <SPAN class="code-keyword">extends</SPAN>
		FacetProjectCreationDataModelProvider {

	<SPAN class="code-keyword">public</SPAN> void init() {
		<SPAN class="code-keyword">super</SPAN>.init();
		FacetDataModelMap map = (FacetDataModelMap) getProperty(FACET_DM_MAP);
		IDataModel javaFacet = DataModelFactory
				.createDataModel(<SPAN class="code-keyword">new</SPAN> JavaFacetInstallDataModelProvider());
		map.add(javaFacet);
		IDataModel jbiFacet = DataModelFactory
				.createDataModel(<SPAN class="code-keyword">new</SPAN> JbiFacetInstallDataModelProvider());
		map.add(jbiFacet);
		javaFacet
				.setProperty(
						IJavaFacetInstallDataModelProperties.SOURCE_FOLDER_NAME,
						jbiFacet
								.getStringProperty(IJbiFacetInstallDataModelProperties.JAVA_SOURCE_FOLDER));
	}
}</PRE>
</DIV></DIV>
<P>Note that we use the provide to get the facet data model map which we can use to all add the new Java data model provider and our JbiFacet install data model provider.  These act to provide information about the parameters that you need to gather.  A quick look at the JbiFacetInstallDataModelProvider gives you the idea.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class JbiFacetInstallDataModelProvider <SPAN class="code-keyword">extends</SPAN>
		J2EEModuleFacetInstallDataModelProvider {

	<SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-object">String</SPAN> JBI_V1_0 = <SPAN class="code-quote">&quot;1.0&quot;</SPAN>;

	<SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-object">String</SPAN> JBI_PROJECT_FACET = <SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>;

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> IProjectFacetVersion JBI_10 = ProjectFacetsManager
			.getProjectFacet(JBI_PROJECT_FACET).getVersion(JBI_V1_0); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>
	<SPAN class="code-keyword">public</SPAN> Set getPropertyNames() {
		Set names = <SPAN class="code-keyword">super</SPAN>.getPropertyNames();
		names.add(CONFIG_FOLDER);
		names.add(IJbiFacetInstallDataModelProperties.JAVA_SOURCE_FOLDER);
		<SPAN class="code-keyword">return</SPAN> names;
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">Object</SPAN> getDefaultProperty(<SPAN class="code-object">String</SPAN> propertyName) {
		<SPAN class="code-keyword">if</SPAN> (propertyName.equals(FACET_ID)) {
			<SPAN class="code-keyword">return</SPAN> JBI_PROJECT_FACET;
		} <SPAN class="code-keyword">else</SPAN> <SPAN class="code-keyword">if</SPAN> (propertyName.equals(CONFIG_FOLDER)) {
			<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;src/main/resources&quot;</SPAN>;
		} <SPAN class="code-keyword">else</SPAN> <SPAN class="code-keyword">if</SPAN> (propertyName
				.equals(IJbiFacetInstallDataModelProperties.JAVA_SOURCE_FOLDER)) {
			<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;src/main/java&quot;</SPAN>;
		}
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">super</SPAN>.getDefaultProperty(propertyName);
	}

	<SPAN class="code-keyword">protected</SPAN> <SPAN class="code-object">int</SPAN> convertFacetVersionToJ2EEVersion(IProjectFacetVersion version) {
		<SPAN class="code-keyword">return</SPAN> J2EEVersionConstants.J2EE_1_4_ID;
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">boolean</SPAN> isPropertyEnabled(<SPAN class="code-object">String</SPAN> propertyName) {
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">super</SPAN>.isPropertyEnabled(propertyName);
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">boolean</SPAN> propertySet(<SPAN class="code-object">String</SPAN> propertyName, <SPAN class="code-object">Object</SPAN> propertyValue) {
		<SPAN class="code-object">boolean</SPAN> status = <SPAN class="code-keyword">false</SPAN>;
		status = <SPAN class="code-keyword">super</SPAN>.propertySet(propertyName, propertyValue);
		<SPAN class="code-keyword">return</SPAN> status;
	}

	<SPAN class="code-keyword">public</SPAN> IStatus validate(<SPAN class="code-object">String</SPAN> propertyName) {
		<SPAN class="code-keyword">return</SPAN> OK_STATUS;
	}

}</PRE>
</DIV></DIV>
<P>The wizard code is simply to build a module,  however since the facet we are adding has a runtime available you suddenly get the runtimes available in the wizard.  Also remember the install delegate we had at the begining, well we have use that to determine whether a runtime was assigned and reference it if it was.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class JbiFacetInstallDelegate <SPAN class="code-keyword">extends</SPAN> J2EEFacetInstallDelegate <SPAN class="code-keyword">implements</SPAN>
		IDelegate {

	<SPAN class="code-keyword">public</SPAN> void execute(IProject project, IProjectFacetVersion fv,
			<SPAN class="code-object">Object</SPAN> config, IProgressMonitor monitor) <SPAN class="code-keyword">throws</SPAN> CoreException {
		<SPAN class="code-keyword">if</SPAN> (monitor != <SPAN class="code-keyword">null</SPAN>) {
			monitor.beginTask(<SPAN class="code-quote">&quot;Installing JBI facet&quot;</SPAN>, 1);
		}

		<SPAN class="code-keyword">try</SPAN> {
			IDataModel model = (IDataModel) config;

			<SPAN class="code-keyword">final</SPAN> IJavaProject jproj = JavaCore.create(project);

			<SPAN class="code-comment">// Add WTP natures.
</SPAN>			WtpUtils.addNatures(project);

			<SPAN class="code-comment">// Setup the flexible project structure.
</SPAN>			<SPAN class="code-keyword">final</SPAN> IVirtualComponent c = ComponentCore.createComponent(project);
			c.create(0, <SPAN class="code-keyword">null</SPAN>);
			c.setMetaProperty(<SPAN class="code-quote">&quot;java-output-path&quot;</SPAN>, <SPAN class="code-quote">&quot;/build/classes/&quot;</SPAN>);

			<SPAN class="code-keyword">final</SPAN> IVirtualFolder jbiRoot = c.getRootFolder();

			<SPAN class="code-comment">// Create directory structure
</SPAN>			<SPAN class="code-object">String</SPAN> srcFolder = <SPAN class="code-keyword">null</SPAN>;
			srcFolder = model
					.getStringProperty(IJbiFacetInstallDataModelProperties.JAVA_SOURCE_FOLDER);
			jbiRoot.createLink(<SPAN class="code-keyword">new</SPAN> Path(<SPAN class="code-quote">&quot;/&quot;</SPAN> + srcFolder), 0, <SPAN class="code-keyword">null</SPAN>);
			<SPAN class="code-object">String</SPAN> resourcesFolder = model
					.getStringProperty(IJbiFacetInstallDataModelProperties.CONFIG_FOLDER);
			jbiRoot.createLink(<SPAN class="code-keyword">new</SPAN> Path(<SPAN class="code-quote">&quot;/&quot;</SPAN> + resourcesFolder), 0, <SPAN class="code-keyword">null</SPAN>);

			<SPAN class="code-comment">// Look ma a runtime!!!!
</SPAN>			IRuntime runtime = (IRuntime) model
					.getProperty(IJbiFacetInstallDataModelProperties.FACET_RUNTIME);
			....
			<SPAN class="code-keyword">if</SPAN> (monitor != <SPAN class="code-keyword">null</SPAN>) {
				monitor.worked(1);
			}
		}

		<SPAN class="code-keyword">finally</SPAN> {
			<SPAN class="code-keyword">if</SPAN> (monitor != <SPAN class="code-keyword">null</SPAN>) {
				monitor.done();
			}
		}

	}
}</PRE>
</DIV></DIV>
<P>As you can imagine this means that information from your runtime can be used to set up special stuff in the project,  such as adding the runtime&apos;s project classpath to the project.  OK... <SPAN class="nobr"><A href="extending-eclipse-wtp-to-support-jbi.data/exampleProject.swf" title="exampleProject.swf attached to Extending Eclipse WTP to support JBI">lets see all that in action<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>

<P>So now we have a server/runtime that we have added,  a type of module and a new project and facet that allows a project to be associated with that facet and thus the runtime/server.  OK,  the final bit we need to think about is how do we make it so that we can add a project to the server (not just associate it with the runtime and publish the project to that server).  Now this is still in development,  but I&apos;ll put up what we have right now so you get the flavour of it all <IMG class="emoticon" src="http://goopen.org/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"></P>

<P>You need to implement three extension points,  these basically tell WTP that your project can create a deployable artifact that it is based on a project and that it is associated with the jst.jbi.component module type.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.core.moduleFactories&quot;</SPAN>&gt;</SPAN>
		&lt;moduleFactory projects=<SPAN class="code-quote">&quot;true&quot;</SPAN>
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.internal.deployables.JBIComponentDeployableFactory&quot;</SPAN>
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.deployables.component&quot;</SPAN>&gt;
			<SPAN class="code-tag">&lt;moduleType versions=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> types=<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>/&gt;</SPAN>
		<SPAN class="code-tag">&lt;/moduleFactory&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN>

	&lt;extension
		point=<SPAN class="code-quote">&quot;org.eclipse.wst.server.core.moduleArtifactAdapters&quot;</SPAN>&gt;
		&lt;moduleArtifactAdapter
			id=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.component&quot;</SPAN>
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbt.internal.deployables.JBIComponentDeployableObjectAdapter&quot;</SPAN>&gt;
			<SPAN class="code-tag">&lt;enablement&gt;</SPAN>
				<SPAN class="code-tag">&lt;with variable=<SPAN class="code-quote">&quot;selection&quot;</SPAN>&gt;</SPAN>
					<SPAN class="code-tag">&lt;adapt type=<SPAN class="code-quote">&quot;org.eclipse.core.resources.IProject&quot;</SPAN> /&gt;</SPAN>
				<SPAN class="code-tag">&lt;/with&gt;</SPAN>
			<SPAN class="code-tag">&lt;/enablement&gt;</SPAN>
		<SPAN class="code-tag">&lt;/moduleArtifactAdapter&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN>

	<SPAN class="code-tag">&lt;extension point=<SPAN class="code-quote">&quot;org.eclipse.core.runtime.adapters&quot;</SPAN>&gt;</SPAN>
		&lt;factory
			class=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.internal.deployables.JBIComponentDeployableObjectAdapter&quot;</SPAN>
			adaptableType=<SPAN class="code-quote">&quot;org.eclipse.core.resources.IProject&quot;</SPAN>&gt;
			&lt;adapter
				type=<SPAN class="code-quote">&quot;org.eclipse.jst.jbi.internal.deployables.IJBIComponentArtifact&quot;</SPAN> /&gt;
		<SPAN class="code-tag">&lt;/factory&gt;</SPAN>
	<SPAN class="code-tag">&lt;/extension&gt;</SPAN></PRE>
</DIV></DIV>
<P>Lets start by looking at the JBIComponentDeployableFactory,  its job is to determine if a project can be deployed,  and to create a module delegate that will actually perform the preparation,  remember it is actually the server that does the publishing, our JBIComponentDeployable is passed to the publishing part of the server definition (in our case the generic ant task) to publish to the server.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-java"><SPAN class="code-keyword">public</SPAN> class JBIComponentDeployable <SPAN class="code-keyword">extends</SPAN> ComponentDeployable {

	<SPAN class="code-keyword">public</SPAN> JBIComponentDeployable(IProject project, IVirtualComponent component) {
		<SPAN class="code-keyword">super</SPAN>(project);
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getContextRoot() {
		Properties props = component.getMetaProperties();
		<SPAN class="code-keyword">if</SPAN> (props.containsKey(<SPAN class="code-quote">&quot;context-root&quot;</SPAN>)) <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>			<SPAN class="code-keyword">return</SPAN> props.getProperty(<SPAN class="code-quote">&quot;context-root&quot;</SPAN>); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>		<SPAN class="code-keyword">return</SPAN> component.getName();
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getURI(IModule module) {
		IVirtualComponent comp = ComponentCore.createComponent(module
				.getProject());
		<SPAN class="code-object">String</SPAN> aURI = <SPAN class="code-keyword">null</SPAN>;
		<SPAN class="code-keyword">if</SPAN> (comp != <SPAN class="code-keyword">null</SPAN>) {
			<SPAN class="code-keyword">if</SPAN> (!comp.isBinary()
					&amp;&amp; isProjectOfType(module.getProject(), <SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>)) {
				IVirtualReference ref = component.getReference(comp.getName());
				aURI = ref.getRuntimePath().append(
						comp.getName() + <SPAN class="code-quote">&quot;-installer.jar&quot;</SPAN>).toString(); <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>			}
		}

		<SPAN class="code-keyword">if</SPAN> (aURI != <SPAN class="code-keyword">null</SPAN> &amp;&amp; aURI.length() &gt; 1 &amp;&amp; aURI.startsWith(<SPAN class="code-quote">&quot;/&quot;</SPAN>)) <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>			aURI = aURI.substring(1);
		<SPAN class="code-keyword">return</SPAN> aURI;
	}

	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getVersion() {
		IFacetedProject facetedProject = <SPAN class="code-keyword">null</SPAN>;
		<SPAN class="code-keyword">try</SPAN> {
			facetedProject = ProjectFacetsManager
					.create(component.getProject());
			<SPAN class="code-keyword">if</SPAN> (facetedProject != <SPAN class="code-keyword">null</SPAN>
					&amp;&amp; ProjectFacetsManager.isProjectFacetDefined(<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>)) {
				IProjectFacet projectFacet = ProjectFacetsManager
						.getProjectFacet(<SPAN class="code-quote">&quot;jst.jbi.component&quot;</SPAN>);
				<SPAN class="code-keyword">return</SPAN> facetedProject.getInstalledVersion(projectFacet)
						.getVersionString();
			}
		} <SPAN class="code-keyword">catch</SPAN> (Exception e) {
			<SPAN class="code-comment">// Ignore
</SPAN>		}
		<SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;1.0&quot;</SPAN>; <SPAN class="code-comment">//$NON-NLS-1$
</SPAN>	}
}</PRE>
</DIV></DIV>
<P>Note that this document will continue to discuss how the IProject is converted through the adaptable pattern into a JbiComponent in the next few days.  In the meantime I&apos;ll leave you with a <SPAN class="nobr"><A href="extending-eclipse-wtp-to-support-jbi.data/examplePublish.swf" title="examplePublish.swf attached to Extending Eclipse WTP to support JBI">little demonstration of how a deployable projects looks<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"></SUP></A></SPAN>.</P></DIV>
          
                  </DIV>
        </TD>
      </TR>
      </TABLE>     
      </DIV>
    </DIV>
    <DIV id="site-footer">
          Added by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=philip.dodds%2540gmail.com">Philip Dodds</A>,
    last edited by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnodet">Guillaume Nodet</A> on May 11, 2006
                  &nbsp;(<A href="http://goopen.org/confluence/pages/diffpages.action?pageId=5040&originalId=5266">view change</A>)
              
      (<A href="http://goopen.org/confluence/pages/editpage.action?pageId=5040">edit page</A>)
    </DIV>

  </BODY>

</HTML>