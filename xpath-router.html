
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
<!--
    Pier's plugin always overwrites the stylesheet so lets explicitly use another one
    <link type="text/css" rel="stylesheet" href="autoexport:///SM/resources/space.css">
-->
    <LINK type="text/css" rel="stylesheet" href="resources/site.css">
    <SCRIPT src="resources/space.js" type="text/javascript"></SCRIPT>
    <TITLE>
XPath Router
    </TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">

    <!-- Banner -->
    <DIV id="site-banner">

      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" class="topbardiv" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/servicemix/images/logo.jpg">
          </TD>
          <TD align="right" nowrap="">
            <IMG border="0" src="http://incubator.apache.org/images/apache-incubator-logo.png">
          </TD>
        </TR> 
      </TABLE>

    </DIV>

    <!-- Bread crumbs and Quick Links -->
    <DIV id="site-navbar">
      <TABLE border="0" cellpadding="0" cellspacing="0" width="100%">
        <TR>
          <TD align="left" valign="middle" nowrap="">
            <DIV id="site-breadcrumbs">
<A href="home.html" title="ServiceMix">ServiceMix</A>&nbsp;&gt;&nbsp;<A href="home.html" title="Home">Home</A>&nbsp;&gt;&nbsp;<A href="features.html" title="Features">Features</A>&nbsp;&gt;&nbsp;<A href="routing.html" title="Routing">Routing</A>&nbsp;&gt;&nbsp;<A href="" title="XPath Router">XPath Router</A>
            </DIV>
          </TD>
          <TD align="right" valign="middle" nowrap="">
            <DIV id="site-quicklinks">
<P><A href="download.html" title="Download">Download</A> &#124; <SPAN class="nobr"><A href="http://incubator.apache.org/servicemix/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> <A href="javadocs.html" title="JavaDocs">More...</A> &#124; <A href="source.html" title="Source">Source</A> &#124; <SPAN class="nobr"><A href="home.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN> &#124;<A href="irc.html" title="IRC">IRC</A> &#124; <A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A> &#124; <A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A> &#124; <A href="support.html" title="Support">Support</A></P>
            </DIV>
          </TD>
        </TR> 
      </TABLE>
    </DIV>

<!-- Integrate google search later.
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF- 8" />
            <input type="hidden" name="oe" value="UTF- 8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
-->

      <DIV id="site-content">
        <TABLE>
        <TR>
        <TD valign="top">
          <DIV id="site-navigation">
<H3><A name="Navigation-Overview"></A>Overview</H3>

<UL class="alternate" type="square">
	<LI><A href="home.html" title="Home">Home</A></LI>
	<LI><A href="introduction-to-esb.html" title="Introduction to ESB">Introduction to ESB</A></LI>
	<LI><A href="background-to-servicemix.html" title="Background to ServiceMix">Background to ServiceMix</A></LI>
	<LI><A href="news.html" title="News">News</A></LI>
	<LI><A href="faq.html" title="FAQ">FAQ</A></LI>
	<LI><A href="site.html" title="Site">Site</A></LI>
	<LI><A href="download.html" title="Download">Download</A></LI>
</UL>


<H3><A name="Navigation-Community"></A>Community</H3>

<UL class="alternate" type="square">
	<LI><A href="support.html" title="Support">Support</A></LI>
	<LI><A href="discussion-forums.html" title="Discussion Forums">Discussion Forums</A></LI>
	<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
	<LI><SPAN class="nobr"><A href="navigation.html" title="Visit page outside Confluence" rel="nofollow">Wiki<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="contributing.html" title="Contributing">Contributing</A></LI>
	<LI><A href="team.html" title="Team">Team</A></LI>
	<LI><A href="users.html" title="Users">Users</A></LI>
</UL>


<H3><A name="Navigation-Documentation"></A>Documentation</H3>

<UL class="alternate" type="square">
	<LI><A href="getting-started.html" title="Getting Started">Getting Started</A></LI>
	<LI><A href="running.html" title="Running">Running</A></LI>
	<LI><A href="examples.html" title="Examples">Examples</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="use-cases-whole.html" title="Use Cases (whole)">Use Cases &#40;whole&#41;</A></LI>
	<LI><A href="configuration.html" title="Configuration">Configuration</A></LI>
	<LI><A href="xml-reference.html" title="Xml Reference">Xml Reference</A></LI>
	<LI><A href="management.html" title="Management">Management</A></LI>
	<LI><A href="architecture.html" title="Architecture">Architecture</A></LI>
	<LI><A href="clustering.html" title="Clustering">Clustering</A></LI>
	<LI><A href="nmr-flows.html" title="NMR Flows">NMR Flows</A></LI>
	<LI><A href="articles.html" title="Articles">Articles</A></LI>
</UL>


<H3><A name="Navigation-Reference"></A>Reference</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://java.sun.com/integration/1.0/docs/sdk/api/index.html" title="Visit page outside Confluence" rel="nofollow">JBI API<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.goopen.org/maven/servicemix-core/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Core<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.goopen.org/maven/servicemix-components/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Components<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://servicemix.goopen.org/maven/servicemix-console/apidocs/" title="Visit page outside Confluence" rel="nofollow">JavaDocs Console<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><A href="glossary.html" title="Glossary">Glossary</A></LI>
</UL>


<H3><A name="Navigation-Features"></A>Features</H3>

<UL class="alternate" type="square">
	<LI><A href="components.html" title="Components">Components</A></LI>
	<LI><A href="routing.html" title="Routing">Routing</A></LI>
	<LI><A href="transformation.html" title="Transformation">Transformation</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">Enterprise Integration Patterns</A></LI>
	<LI><A href="spring-client-toolkit.html" title="Spring Client Toolkit">Spring Client Toolkit</A></LI>
	<LI><A href="client-api.html" title="Client API">Client API</A></LI>
	<LI><A href="beanflow.html" title="BeanFlow">BeanFlow</A></LI>
	<LI><A href="pojo-support.html" title="POJO support">POJO support</A></LI>
	<LI><A href="expressions.html" title="Expressions">Expressions</A></LI>
	<LI><A href="component-helper-classes.html" title="Component helper classes">Component helper classes</A></LI>
	<LI><A href="ant-tasks.html" title="Ant Tasks">Ant Tasks</A></LI>
	<LI><A href="jmx-console.html" title="JMX Console">JMX Console</A></LI>
</UL>


<H3><A name="Navigation-Integration"></A>Integration</H3>

<UL class="alternate" type="square">
	<LI><A href="spring-support.html" title="Spring support">Spring support</A></LI>
	<LI><A href="geronimo-integration.html" title="Geronimo Integration">Geronimo Integration</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Integration</A></LI>
	<LI><A href="tomcat-integration.html" title="Tomcat Integration">Tomcat Integration</A></LI>
	<LI><A href="jonas-integration.html" title="JOnAS Integration">JOnAS Integration</A></LI>
	<LI><A href="jndi-configuration.html" title="JNDI configuration">JNDI configuration</A></LI>
</UL>


<H3><A name="Navigation-Components"></A><A href="components.html" title="Components">Components</A></H3>

<UL class="alternate" type="square">
	<LI><A href="servicemix-http.html" title="servicemix-http">servicemix&#45;http</A></LI>
	<LI><A href="servicemix-jms.html" title="servicemix-jms">servicemix&#45;jms</A></LI>
	<LI><A href="servicemix-eip.html" title="servicemix-eip">servicemix&#45;eip</A></LI>
	<LI><A href="servicemix-bpe.html" title="servicemix-bpe">servicemix&#45;bpe</A></LI>
	<LI><A href="servicemix-jsr181.html" title="servicemix-jsr181">servicemix&#45;jsr181</A></LI>
	<LI><A href="servicemix-wsn2005.html" title="servicemix-wsn2005">servicemix&#45;wsn2005</A></LI>
</UL>


<UL class="alternate" type="square">
	<LI><A href="lightweight-components.html" title="Lightweight components">Lightweight components</A></LI>
</UL>


<H3><A name="Navigation-Tooling"></A>Tooling</H3>

<UL class="alternate" type="square">
	<LI><A href="maven-jbi-plugin.html" title="Maven JBI plugin">Maven JBI plugin</A></LI>
	<LI><A href="eclipse-plugin.html" title="Eclipse plugin">Eclipse plugin</A></LI>
	<LI><A href="visualisation.html" title="Visualisation">Visualisation</A></LI>
	<LI><A href="jboss-deployer.html" title="JBoss Deployer">JBoss Deployer</A></LI>
	<LI><A href="war-deployment.html" title="WAR Deployment">WAR Deployment</A></LI>
	<LI><A href="maven-sar-plugin.html" title="Maven SAR plugin">Maven SAR plugin</A></LI>
</UL>


<H3><A name="Navigation-RelatedProjects"></A>Related Projects</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/activemq/" title="High Performance Message Bus" rel="nofollow">Apache ActiveMQ<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://lingo.codehaus.org/" title="POJO Remoting using JMS" rel="nofollow">Lingo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://jencks.org/" title="Message Driven POJOs and pooling for JMS and JDBC" rel="nofollow">Jencks<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://stomp.codehaus.org/" title="Simple cross language protocol for messaging" rel="nofollow">Stomp<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://www.springframework.org/" title="Visit page outside Confluence" rel="nofollow">Spring<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://geronimo.apache.org/" title="Visit page outside Confluence" rel="nofollow">Geronimo<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://forge.objectweb.org/projects/celtix/" title="Visit page outside Confluence" rel="nofollow">Celtix<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://xfire.codehaus.org/" title="Visit page outside Confluence" rel="nofollow">XFire<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://incubator.apache.org/projects/ode.html" title="Orchestration Engine" rel="nofollow">Apache ODE<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Support"></A>Support</H3>

<UL class="alternate" type="square">
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM" title="Visit page outside Confluence" rel="nofollow">Issues<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:roadmap-panel" title="Visit page outside Confluence" rel="nofollow">Roadmap<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
	<LI><SPAN class="nobr"><A href="http://issues.apache.org/activemq/browse/SM?report=com.atlassian.jira.plugin.system.project:changelog-panel" title="Visit page outside Confluence" rel="nofollow">Change log<SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></LI>
</UL>


<H3><A name="Navigation-Developers"></A>Developers</H3>

<UL class="alternate" type="square">
	<LI><A href="source.html" title="Source">Source</A></LI>
	<LI><A href="building.html" title="Building">Building</A></LI>
	<LI><A href="ideas.html" title="Ideas">Ideas</A></LI>
	<LI><A href="becoming-a-committer.html" title="Becoming a committer">Becoming a committer</A></LI>
	<LI><A href="release-guide.html" title="Release Guide">Release Guide</A></LI>
</UL>


<H3><A name="Navigation-Toolsweuse"></A>Tools we use</H3>

<P><SPAN class="nobr"><A href="http://www.yourkit.com/" title="Visit page outside Confluence" rel="nofollow"><IMG src="navigation.data/yourkit.jpg" align="absmiddle" border="0"><SUP><IMG class="rendericon" src="http://goopen.org/confluence/images/icons/linkext7.gif" height="0" width="0" align="absmiddle" alt="" border="0"></SUP></A></SPAN></P>
          </DIV>
        </TD>
        <TD valign="top">
          <DIV id="site-page">

<!--          
            <div class="pagetitle">XPath Router</div>
-->
            <DIV class="wiki-content">
<P>Its often a requirement to perform <EM>content based routing</EM> in an ESB. This means you route messages around your service bus based on the message properties or the content of the messages. When integrating systems across language boundaries its common to use XML as a universal message format; so XPath is an ideal tool to perform content based routing and transformation.</P>

<P>We support a XPath based routing and transformation mechanism designed for high performance and power.</P>

<H3><A name="XPathRouter-Example"></A>Example</H3>

<P>The following is an example routing and transformation template. Firstly we reuse the XSLT basd transform component.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml"><SPAN class="code-tag">&lt;sm:activationSpec componentName=<SPAN class="code-quote">&quot;transformer&quot;</SPAN> service=<SPAN class="code-quote">&quot;foo:transformer&quot;</SPAN>&gt;</SPAN>
  <SPAN class="code-tag">&lt;sm:component&gt;</SPAN><SPAN class="code-tag">&lt;bean class=<SPAN class="code-quote">&quot;org.apache.servicemix.components.xslt.XsltComponent&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;xsltResource&quot;</SPAN> value=<SPAN class="code-quote">&quot;classpath:org/apache/servicemix/components/xslt/router.xsl&quot;</SPAN>/&gt;</SPAN>

    &lt;!-- lets disable automatic output of the result of the transform; only if we perform
        an invoke in the XSLT will we invoke another endpoint --&gt;
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;disableOutput&quot;</SPAN> value=<SPAN class="code-quote">&quot;true&quot;</SPAN>/&gt;</SPAN>
  <SPAN class="code-tag">&lt;/bean&gt;</SPAN><SPAN class="code-tag">&lt;/sm:component&gt;</SPAN>
<SPAN class="code-tag">&lt;/sm:activationSpec&gt;</SPAN></PRE>
</DIV></DIV>
<P>&nbsp;</P>

<P>Then we provide a file in XSLT format, with some JBI extensions</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml">&lt;<SPAN class="code-keyword">xsl:stylesheet</SPAN> <SPAN class="code-keyword">xmlns:xsl</SPAN>=<SPAN class="code-quote">&quot;http://www.w3.org/1999/XSL/Transform&quot;</SPAN>
  <SPAN class="code-keyword">xmlns:jbi</SPAN>=<SPAN class="code-quote">&quot;xalan://org.apache.servicemix.components.xslt.XalanExtension&quot;</SPAN>
  extension-element-prefixes=<SPAN class="code-quote">&quot;jbi&quot;</SPAN>

  <SPAN class="code-keyword">xmlns:foo</SPAN>=<SPAN class="code-quote">&quot;http://servicemix.org/cheese/&quot;</SPAN>
  version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>&gt;

  <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:template</SPAN> match=<SPAN class="code-quote">&quot;/*&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:choose</SPAN>&gt;</SPAN>

      <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- lets forward the inbound message to a service --&gt;</SPAN></SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:when</SPAN> test=<SPAN class="code-quote">&quot;@id = &apos;4&apos;&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;jbi:forward service=<SPAN class="code-quote">&quot;foo:trace&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:when</SPAN>&gt;</SPAN>

      <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- lets generate the output XML to use as input, copy the input properties and define some new propertes --&gt;</SPAN></SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:when</SPAN> test=<SPAN class="code-quote">&quot;@id = &apos;12&apos;&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:script&quot;</SPAN>&gt;</SPAN>
          <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
          <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;foo&quot;</SPAN> select=<SPAN class="code-quote">&quot;@sent&quot;</SPAN>/&gt;</SPAN>
          <SPAN class="code-tag">&lt;cheese code=<SPAN class="code-quote">&quot;{@id}&quot;</SPAN>&gt;</SPAN>
            <SPAN class="code-tag">&lt;description&gt;</SPAN>This is some content generated from the routing XSL<SPAN class="code-tag">&lt;/description&gt;</SPAN>
          <SPAN class="code-tag">&lt;/cheese&gt;</SPAN>
        <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>
      <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:when</SPAN>&gt;</SPAN>

      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:when</SPAN> test=<SPAN class="code-quote">&quot;@id != &apos;2&apos;&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;jbi:forward service=<SPAN class="code-quote">&quot;foo:receiver&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:when</SPAN>&gt;</SPAN>

      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:otherwise</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;jbi:forward service=<SPAN class="code-quote">&quot;foo:trace&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:otherwise</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:choose</SPAN>&gt;</SPAN>
  <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:template</SPAN>&gt;</SPAN>

<SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:stylesheet</SPAN>&gt;</SPAN></PRE>
</DIV></DIV>
<P>&nbsp;</P>

<P>In the above example, depending on the value of the @id attribute, we invoke different services.</P>

<P>Notice that we declare the jbi namespace and some attributes on the root XSLT stylesheet element. We then have the following extension elements available to the XSTL</P>

<H3><A name="XPathRouter-Xalanextensionsummary"></A>Xalan extension summary</H3>

<P>The following new XML tags are available in Xalan when working with ServiceMix</P>
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Element </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> forward </TD>
<TD class="confluenceTd"> will forward the current inbound message to the given service, interface and/or operation. This mechanism will use the properties and content of the inbound message to create the outbound message </TD>
</TR>
<TR>
<TD class="confluenceTd"> invoke </TD>
<TD class="confluenceTd"> will perform a one way service invocation where the body of the invoke tag represents the XML content of the message. Notice from the above we can use XPath expressions to create the XML </TD>
</TR>
</TBODY></TABLE>

<H3><A name="XPathRouter-Invokingmultipleserviceendpoints"></A>Invoking multiple service endpoints</H3>

<P>The following example shows a number of services being invoked one after the other, using optionally different properties. In each case the original XML message is used as the body of the new inbound request.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml">&lt;<SPAN class="code-keyword">xsl:stylesheet</SPAN> <SPAN class="code-keyword">xmlns:xsl</SPAN>=<SPAN class="code-quote">&quot;http://www.w3.org/1999/XSL/Transform&quot;</SPAN>
                <SPAN class="code-keyword">xmlns:jbi</SPAN>=<SPAN class="code-quote">&quot;xalan://org.apache.servicemix.components.xslt.XalanExtension&quot;</SPAN>
                extension-element-prefixes=<SPAN class="code-quote">&quot;jbi&quot;</SPAN>

                <SPAN class="code-keyword">xmlns:foo</SPAN>=<SPAN class="code-quote">&quot;http://servicemix.org/cheese/&quot;</SPAN>
                version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>&gt;

  <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:strip-space</SPAN> elements=<SPAN class="code-quote">&quot;*&quot;</SPAN>/&gt;</SPAN>

  <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:template</SPAN> match=<SPAN class="code-quote">&quot;/&quot;</SPAN>&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- lets invoke a number of services one after the other --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service1&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;foo&quot;</SPAN> select=<SPAN class="code-quote">&quot;/sample&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service2&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;bar&quot;</SPAN> select=<SPAN class="code-quote">&quot;/sample/@id&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service3&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;foo&quot;</SPAN> select=<SPAN class="code-quote">&quot;string(/sample)&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;bar&quot;</SPAN> select=<SPAN class="code-quote">&quot;string(/sample/@id)&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:receiver&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;bar&quot;</SPAN> select=<SPAN class="code-quote">&quot;/sample/@id&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

  <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:template</SPAN>&gt;</SPAN>

<SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:stylesheet</SPAN>&gt;</SPAN></PRE>
</DIV></DIV>
<P>&nbsp;</P>

<H3><A name="XPathRouter-SplittingupanXMLmessageintomultipleserviceinvocations"></A>Splitting up an XML message into multiple service invocations</H3>

<P>This example demonstrates a message being split into multiple different sections of XML which are then invoked on different services.</P>
<DIV class="code"><DIV class="codeContent">
<PRE class="code-xml">&lt;<SPAN class="code-keyword">xsl:stylesheet</SPAN> <SPAN class="code-keyword">xmlns:xsl</SPAN>=<SPAN class="code-quote">&quot;http://www.w3.org/1999/XSL/Transform&quot;</SPAN>
                <SPAN class="code-keyword">xmlns:jbi</SPAN>=<SPAN class="code-quote">&quot;xalan://org.apache.servicemix.components.xslt.XalanExtension&quot;</SPAN>
                extension-element-prefixes=<SPAN class="code-quote">&quot;jbi&quot;</SPAN>
                <SPAN class="code-keyword">xmlns:foo</SPAN>=<SPAN class="code-quote">&quot;http://servicemix.org/cheese/&quot;</SPAN> version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>&gt;

  <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:template</SPAN> match=<SPAN class="code-quote">&quot;/&quot;</SPAN>&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- lets pass a new message body --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service1&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;cheese id=<SPAN class="code-quote">&quot;{/foo/@id}&quot;</SPAN>&gt;</SPAN>Edam<SPAN class="code-tag">&lt;/cheese&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  lets split the message  --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service2&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/foo/beer&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- 1-many split --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:for-each</SPAN> select=<SPAN class="code-quote">&quot;/foo/lineitem&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:service3&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;.&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>
    <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:for-each</SPAN>&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  pass the  entire message to the final endpoint  --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;jbi:invoke service=<SPAN class="code-quote">&quot;foo:receiver&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:copyProperties/&gt;</SPAN>
      <SPAN class="code-tag">&lt;jbi:setOutProperty name=<SPAN class="code-quote">&quot;bar&quot;</SPAN> select=<SPAN class="code-quote">&quot;/sample/@id&quot;</SPAN>/&gt;</SPAN>
      <SPAN class="code-tag">&lt;<SPAN class="code-keyword">xsl:copy-of</SPAN> select=<SPAN class="code-quote">&quot;/&quot;</SPAN>/&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jbi:invoke&gt;</SPAN>

  <SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:template</SPAN>&gt;</SPAN>
<SPAN class="code-tag">&lt;/<SPAN class="code-keyword">xsl:stylesheet</SPAN>&gt;</SPAN></PRE>
</DIV></DIV>
<P>&nbsp;</P>

<H3><A name="XPathRouter-WhyuseXalan%3F"></A>Why use Xalan?</H3>

<P>We use Xalan to implement our XPath based router and transformation engine. The main reasons for doing so are</P>
<UL>
	<LI>we typically need to evaluate many XPath expressions on a single message exchange; so we can create them all inside the stylesheet such that they are evaluated efficiently each time.</LI>
	<LI>Xalan can turn the stylesheet into bytecode, which we can then cache/pool to ensure the routing and transformations are as fast as possible while still using the power and flexiblity of XPath.</LI>
	<LI>Xalan is optimised to only parse what is required of a document to satisfy the template</LI>
</UL>
</DIV>
          
                  </DIV>
        </TD>
      </TR>
      </TABLE>     
      </DIV>
    </DIV>
    <DIV id="site-footer">
          Added by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=jstrachan">James Strachan</A>,
    last edited by     <A href="http://goopen.org/confluence/users/viewuserprofile.action?username=gnt">gnt</A> on Dec 30, 2005
                  &nbsp;(<A href="http://goopen.org/confluence/pages/diffpages.action?pageId=2045&originalId=4125">view change</A>)
              
      (<A href="http://goopen.org/confluence/pages/editpage.action?pageId=2045">edit page</A>)
    </DIV>

  </BODY>

</HTML>